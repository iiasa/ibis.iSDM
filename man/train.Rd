% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/train.R
\name{train}
\alias{train}
\alias{train,}
\alias{train-method}
\title{Train the model from a given engine}
\usage{
train(
  x,
  runname,
  rm_corPred = FALSE,
  varsel = "none",
  inference_only = FALSE,
  only_linear = TRUE,
  method_integration = "predictor",
  bias_variable = NULL,
  bias_value = NULL,
  aggregate_observations = TRUE,
  verbose = FALSE,
  ...
)

\S4method{train}{BiodiversityDistribution}(x)
}
\arguments{
\item{x}{\code{\link[=distribution]{distribution()}} (i.e. \code{\linkS4class{BiodiversityDistribution}}) object).}

\item{runname}{A \code{\link{character}} name of the trained run.}

\item{rm_corPred}{Remove highly correlated predictors (Default: \code{FALSE}). This option
removes - based on pairwise comparisons - those covariates that are highly collinear (Pearson's \code{r >= 0.7}).}

\item{varsel}{Perform a variable selection on the set of predictors either prior to building the model
or via variable selection / regularization of the model. Available options are:
\itemize{
\item \code{\link{none}} for no or default priors and no extensive hyperparameter search.
\item \code{\link{reg}} Model selection either through DIC or regularization / hyperparameter tuning depending on the
engine (Default).
\item \code{\link{abess}} A-priori adaptive best subset selection of covariates via the \link{abess} package (see References).
Note that this effectively fits a separate generalized linear model to reduce the number of covariates.
Can be helpful for engines that don't directly support efficient variable regularization and when \code{N>100}.
}}

\item{inference_only}{By default the \link{engine} is used to create
a spatial prediction of the suitability surface, which can take time. If only inferences of
the strength of relationship between covariates and observations are required, this parameter
can be set to \code{TRUE} to ignore any spatial projection (Default: \code{FALSE}).}

\item{only_linear}{Fit model only on linear baselearners and functions. Depending
on the \link{engine} setting this option to \code{FALSE} will result in non-linear relationships
between observations and covariates, often increasing processing time (Default: \code{TRUE}).
How non-linearity is captured depends on the used \link{engine}.}

\item{method_integration}{A \code{\link{character}} with the type of integration that should be applied if more
than one \code{\linkS4class{BiodiversityDataset}} object is provided in \code{x}. Particular relevant for engines
that do not support the integration of more than one dataset. Integration methods are generally sensitive
to the order in which they have been added to the  \code{\link{BiodiversityDistribution}} object.
Available options are:
\link{*} \code{"predictor"} The predicted output of the first (or previously fitted) models are
added to the predictor stack and thus are predictors for subsequent models (Default).
\link{*} \code{"offset"} The predicted output of the first (or previously fitted) models are
added as spatial offsets to subsequent models. Offsets are back-transformed depending
on the model family. This option might not be supported for every \code{\link{engine}}.
\link{*} \code{"interaction"} Instead of fitting several separate models, the observations from each dataset
are combined and incorporated in the prediction as a factor interaction with the "weaker" data source being
partialed out during prediction. Here the first dataset added determines the reference level
(see Leung et al. 2019 for a description).
\link{*} \code{"prior"} In this option we only make use of the coefficients from a previous model to define priors to be used in the next model.
Might not work with any engine!
\link{*} \code{"weight"} This option only works for multiple biodiversity datasets with the same type (e.g. \code{"poipo"}).
Individual weight multipliers can be determined while setting up the model (\strong{Note: Default is 1}). Datasets are then combined for estimation
and weighted respectively, thus giving for example presence-only records less weight than survey records.

\strong{Note that this parameter is ignored for engines that support joint likelihood estimation.}}

\item{bias_variable}{A \code{\link{vector}} with names of variables to be set to \emph{bias_value} (Default: \code{NULL}).
This option can for instance be used to 'partial' out certain biases after predictions have been made.
See Examples.}

\item{bias_value}{A \code{\link{vector}} with values to be set to \emph{bias_variable} (Default: \code{NULL}).
Specifying a \code{\link{numeric}} value here sets \code{bias_variable} to the target value.}

\item{aggregate_observations}{\code{\link{logical}} on whether observations covering the same grid cell should be aggregated (Default: \code{TRUE}).}

\item{...}{further arguments passed on.}
}
\value{
A \link{DistributionModel} object.
}
\description{
This function trains a \code{\link[=distribution]{distribution()}} model with the specified engine and
furthermore has some generic options that apply to all engines (regardless of type).
See Details with regards to such options.

Users are advised to check the help files for individual \link{engine}s for advice on how
the estimation is being done.
}
\details{
This function acts as a generic training function that - based on the provided \code{\linkS4class{BiodiversityDistribution}}
object creates a new distribution model.
The resulting object contains both a \code{\link{fit_best}} object of the estimated model and, if \code{inference_only} is \code{FALSE}
a \link{RasterLayer} object named \code{\link{prediction}} that contains the spatial prediction of the model.
These objects can be requested via \code{object$get_data("fit_best")}.

Available options in this function include:
\link{*} \code{"rm_corPred"} Setting this to \code{TRUE} removes highly correlated variables for the observation
prior to fitting.
\link{*} \code{"varsel"} This option allows to make use of hyper-parameter search for several models (\code{"reg"}) or
alternatively of variable selection methods to further reduce model complexity. Generally substantially increases
runtime. The option makes use of the \code{"abess"} approach (Zhu et al. 2020) to identify and remove the least-important
variables.
\link{*} \code{"method_integration"} Only relevant if more than one \code{\link{BiodiversityDataset}} is supplied and when
the engine does not support joint integration of likelihoods.
See also Miller et al. (2019) in the references for more details on different types of integration. Of course,
if users want more control about this aspect, another option is to fit separate models
and make use of the \link{add_offset}, \link{add_offset_range} and \link{ensemble} functionalities.
\link{*} \code{"bias_variable"} and \code{"bias_value"} Specifying a variable and value here performs a model-based
control of a certain bias variable (e.g. accessibility) with the variable in question being partialed out during
the prediction step.
}
\examples{
\dontrun{
 # Fit a linear penalized logistic regression model via stan
 x <- distribution(background) \%>\%
        # Presence-absence data
        add_biodiversity_poipa(surveydata) \%>\%
        # Add predictors and scale them
        add_predictors(env = predictors, transform = "scale", derivates = "none") \%>\%
        # Use stan for estimation
        engine_stan(chains = 2, iter = 1000, warmup = 500)
 # Train the model
 mod <- train(x, only_linear = TRUE, varsel = 'none')
 mod
}
}
\references{
\itemize{
\item Miller, D.A.W., Pacifici, K., Sanderlin, J.S., Reich, B.J., 2019. The recent past and promising future for data integration methods to estimate species’ distributions. Methods Ecol. Evol. 10, 22–37. https://doi.org/10.1111/2041-210X.13110
\item Zhu, J., Wen, C., Zhu, J., Zhang, H., & Wang, X. (2020). A polynomial algorithm for best-subset selection problem. Proceedings of the National Academy of Sciences, 117(52), 33117-33123.
\item Leung, B., Hudgins, E. J., Potapova, A. & Ruiz‐Jaen, M. C. A new baseline for countrywide α‐diversity and species distributions: illustration using >6,000 plant species in Panama. Ecol. Appl. 29, 1–13 (2019).
}
}
\seealso{
\link{engine_gdb}, \link{engine_xgboost}, \link{engine_bart}, \link{engine_inla}, \link{engine_inlabru}, \link{engine_breg}, \link{engine_stan}
}
