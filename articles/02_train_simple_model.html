<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ibis.iSDM">
<title>Train a basic model • ibis.iSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Train a basic model">
<meta property="og:description" content="ibis.iSDM">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@Martin_Ecology">
<meta name="twitter:site" content="@IIASAVienna">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ibis.iSDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/01_data_preparationhelpers.html">1. Helper functions to prepare inputs</a>
    <a class="dropdown-item" href="../articles/02_train_simple_model.html">2. Train a model</a>
    <a class="dropdown-item" href="../articles/03_integrate_data.html">3. Integrate data</a>
    <a class="dropdown-item" href="../articles/04_biodiversity_projections.html">4. Biodiversity projections</a>
    <a class="dropdown-item" href="../articles/05_mechanistic_estimation.html">5. Simulating mechanisms</a>
    <a class="dropdown-item" href="../articles/06_engine_comparison.html">6. Engine comparison</a>
    <a class="dropdown-item" href="../articles/07_package_comparison.html">7. Other packages</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/08_frequently-asked-questions.html">FAQ</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/contributing.html">Contributing</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/iiasa/ibis.iSDM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Train a basic model</h1>
                        <h4 data-toc-skip class="author">Martin
Jung</h4>
            
            <h4 data-toc-skip class="date">2023-09-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/iiasa/ibis.iSDM/blob/HEAD/vignettes/articles/02_train_simple_model.Rmd" class="external-link"><code>vignettes/articles/02_train_simple_model.Rmd</code></a></small>
      <div class="d-none name"><code>02_train_simple_model.Rmd</code></div>
    </div>

    
    
<p>The examples below demonstrate how to fit a basic model with the
ibis.iSDM package using a variety of engines. The ibis.iSDM package
loosely follows the <strong>tidyverse</strong> strategy where a model is
built by adding different components via pipes. Every model needs to
have a minimum of at least 3 components:</p>
<ul>
<li><p>A background layer that delineates the modelling extent. This
layer can be supplied as <code>sf</code> or <code>RasterLayer</code>
object and provides the package with general knowledge about the
modelling extent, the geographic projection and grain size as well as
areas with no (<code>NA</code>) and valid data range (<code>1</code> or
other values).</p></li>
<li><p>Spatial-explicit biodiversity distribution data such as point or
polygon data on species or ecosystems. Methods to add those are
available in functions that start with [<code>add_biodiversity_*</code>]
can be of various types. Types in this context refer to the form the
biodiversity data was raised, such as presence-only or presence-absence
information. There are ways to convert for instance
presence-only</p></li>
<li><p>A engine to do the estimation. Like many other species
distribution modelling approaches, the ibis.iSDM package makes use of
Bayesian and Machine Learning approaches to do the estimation. While
writing this text the package supports a total of 7
(<code>length(getOption("ibis.engines") )</code>) different engines,
each with their own modelling approaches.</p></li>
</ul>
<hr>
<div class="section level3">
<h3 id="load-package-and-make-a-basic-model">Load package and make a basic model<a class="anchor" aria-label="anchor" href="#load-package-and-make-a-basic-model"></a>
</h3>
<pre><code><span><span class="co">#&gt; inlabru xgboost   rgeos  igraph </span></span>
<span><span class="co">#&gt;    TRUE    TRUE    TRUE    TRUE</span></span></code></pre>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://iiasa.github.io/ibis.iSDM/">ibis.iSDM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.inlabru.org" class="external-link">inlabru</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmlc/xgboost" class="external-link">xgboost</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rforge.net/uuid" class="external-link">uuid</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">assertthat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Don't print out as many messages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"ibis.setupmessages"</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Creating a model in the <code>ibis.iSDM</code> package is relatively
straight forward which we demonstrate here with some of testdata that
come with the package. These data show the distribution of a simulated
forest-associated species for northern Europe. There are also some test
predictors available for modelling. So first lets load the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Background layer</span></span>
<span><span class="va">background</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/europegrid_50km.tif"</span>,package <span class="op">=</span> <span class="st">"ibis.iSDM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Load virtual species points</span></span>
<span><span class="va">virtual_species</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/input_data.gpkg"</span>,package <span class="op">=</span> <span class="st">"ibis.iSDM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"points"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Reading layer `points' from data source </span></span>
<span><span class="co">#&gt;   `/home/runner/work/_temp/Library/ibis.iSDM/extdata/input_data.gpkg' </span></span>
<span><span class="co">#&gt;   using driver `GPKG'</span></span>
<span><span class="co">#&gt; Simple feature collection with 208 features and 5 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4.109162 ymin: 48.7885 xmax: 24.47594 ymax: 64.69323</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co"># Predictors</span></span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/predictors/"</span>, package <span class="op">=</span> <span class="st">"ibis.iSDM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"*.tif"</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Make use only of a few of them</span></span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">predictors</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01_mean_50km"</span>,<span class="st">"bio03_mean_50km"</span>,<span class="st">"bio19_mean_50km"</span>,</span>
<span>                                            <span class="st">"CLC3_112_mean_50km"</span>,<span class="st">"CLC3_132_mean_50km"</span>,</span>
<span>                                            <span class="st">"CLC3_211_mean_50km"</span>,<span class="st">"CLC3_312_mean_50km"</span>,</span>
<span>                                            <span class="st">"elevation_mean_50km"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For our example model we are going to use ‘Integrated Nested Laplace
approximation (INLA)’ modelling framework as available through the
<code>INLA</code> and <code>inlabru</code> packages. Both have been
implemented separately in the ibis.iSDM package, but especially when
dealing with future scenarios the use of the <code>inlabru</code>
package is advised.</p>
<p>Now lets build a simple model object. In this case we make use of
presence-only biodiversity records
(<code>add_biodiversity_poipo</code>). Any presence-only records added
to an object created through <code><a href="../reference/distribution.html">distribution()</a></code> are by default
modelled as intensity <span class="math inline">\(\lambda\)</span>
through an inhomogeneous Poisson point process model (PPM), where the
Number of Individuals <span class="math inline">\(N\)</span> is
integrated as relative rate of occurrence per unit area: <span class="math inline">\(N_i \sim Poisson(\lambda_i|A_i)\)</span>. Here
<span class="math inline">\(\lambda\)</span> can then be estimated by
relating it to environmental covariates <span class="math inline">\(log(\lambda_i) = \alpha + \beta(x_i)\)</span>,
where <span class="math inline">\(i\)</span> is a grid cell.</p>
<p>It is inhomogeneous since the <span class="math inline">\(lambda\)</span> varies over the whole sampling
extent. In the context of species distribution modelling PPMs are
structurally similar to the popular Maxent modelling framework (see <a href="https://onlinelibrary.wiley.com/doi/10.1111/j.1541-0420.2012.01824.x" class="external-link">Renner
&amp; Warton 2013</a> and <a href="http://doi.wiley.com/10.1111/2041-210X.12352" class="external-link">Renner et
al. 2015</a>. Critically, presence-only records can only give an
indication of a biased sampling and thus sampling bias has to be taken
somehow into account, either through careful data preparation, apriori
thinning or model-based control by including covariates <span class="math inline">\(\sigma_i\)</span> that might explain this sampling
bias.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># First we define a distribution object using the background layer</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then lets add species data to it. </span></span>
<span><span class="co"># This data needs to be in sf format and key information is that</span></span>
<span><span class="co"># the model knows where occurrence data is stored (e.g. how many observations per entry) as</span></span>
<span><span class="co"># indicated by the field_occurrence field.</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_biodiversity_poipo.html">add_biodiversity_poipo</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">virtual_species</span>,</span>
<span>                                      name <span class="op">=</span> <span class="st">"Virtual test species"</span>,</span>
<span>                                      field_occurrence <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Then lets add predictor information</span></span>
<span><span class="co"># Here we are interested in basic transformations (scaling), but derivates (like quadratic)</span></span>
<span><span class="co"># for now, but check options</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>                      env <span class="op">=</span> <span class="va">predictors</span>,</span>
<span>                      transform <span class="op">=</span> <span class="st">"scale"</span>, derivates <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Finally define the engine for the model</span></span>
<span><span class="co"># This uses the default data currently backed in the model,</span></span>
<span><span class="co"># !Note that any other data might require an adaptation of the default mesh parameters used by the engine!</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/engine_inlabru.html">engine_inlabru</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print out the object to see the information that is now stored within</span></span>
<span><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">&lt;Biodiversity distribution model&gt;</span></span></span>
<span><span class="co">#&gt; Background extent: </span></span>
<span><span class="co">#&gt;      xmin: -16.064, xmax: 36.322,</span></span>
<span><span class="co">#&gt;      ymin: 34.95, ymax: 71.535</span></span>
<span><span class="co">#&gt;    projection: +proj=longlat +datum=WGS84 +no_defs</span></span>
<span><span class="co">#&gt;  --------- </span></span>
<span><span class="co">#&gt; Biodiversity data:</span></span>
<span><span class="co">#&gt;    Point - Presence only &lt;208 records&gt;</span></span>
<span><span class="co">#&gt;  --------- </span></span>
<span><span class="co">#&gt;   predictors:     bio01_mean_50km, bio03_mean_50km, bio19_mean_50km, ... (8 predictors)</span></span>
<span><span class="co">#&gt;   priors:         &lt;Default&gt;</span></span>
<span><span class="co">#&gt;   latent:         None</span></span>
<span><span class="co">#&gt;   log:            &lt;Console&gt;</span></span>
<span><span class="co">#&gt;   engine:         &lt;INLABRU&gt;</span></span></code></pre></div>
<p>The <code>print</code> call at the end now shows some summary
statistics contained in this object, such as the extent of the modelling
background and the projection used, the number of biodiversity datasets
added and statistics on the predictors, eventual priors and which engine
is being used.</p>
<p>Of course all of these steps can also be done in “pipe” using the
<code>|&gt;</code> syntax.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="st">"Create model"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Create model"</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>       <span class="fu"><a href="../reference/add_biodiversity_poipo.html">add_biodiversity_poipo</a></span><span class="op">(</span><span class="va">virtual_species</span>,</span>
<span>                              name <span class="op">=</span> <span class="st">"Virtual test species"</span>,</span>
<span>                              field_occurrence <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>      <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span>env <span class="op">=</span> <span class="va">predictors</span>, transform <span class="op">=</span> <span class="st">"scale"</span>, derivates <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/engine_inlabru.html">engine_inlabru</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p>Also very helpful to know is that this object contains a number of
helper functions that allow easy summary or visualization of the
contained data. For example, it is possible to plot and obtain any of
the data added to this object.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make visualization of the contained biodiversity data</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">biodiversity</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_train_simple_model_files/figure-html/unnamed-chunk-3-1.png" width="528" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Other options to explore</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "set_engine"                  "engine"                     </span></span>
<span><span class="co">#&gt;  [3] "latentfactors"               "get_predictor_names"        </span></span>
<span><span class="co">#&gt;  [5] "show_biodiversity_equations" "rm_limits"                  </span></span>
<span><span class="co">#&gt;  [7] "plot_offsets"                "set_limits"                 </span></span>
<span><span class="co">#&gt;  [9] "get_extent"                  "print"                      </span></span>
<span><span class="co">#&gt; [11] "summary"                     "set_biodiversity"           </span></span>
<span><span class="co">#&gt; [13] "get_prior_variables"         "set_log"                    </span></span>
<span><span class="co">#&gt; [15] "plot"                        "set_offset"                 </span></span>
<span><span class="co">#&gt; [17] "get_latent"                  "get_biodiversity_types"     </span></span>
<span><span class="co">#&gt; [19] "set_priors"                  "rm_offset"                  </span></span>
<span><span class="co">#&gt; [21] "bias"                        "rm_predictors"              </span></span>
<span><span class="co">#&gt; [23] "get_resolution"              "set_predictors"             </span></span>
<span><span class="co">#&gt; [25] "rm_priors"                   "show_biodiversity_length"   </span></span>
<span><span class="co">#&gt; [27] ".that"                       "background"                 </span></span>
<span><span class="co">#&gt; [29] "set_latent"                  ".super"                     </span></span>
<span><span class="co">#&gt; [31] "get_limits"                  "get_biodiversity_equations" </span></span>
<span><span class="co">#&gt; [33] "rm_engine"                   "get_extent_dimensions"      </span></span>
<span><span class="co">#&gt; [35] "get_log"                     "rm_biascontrol"             </span></span>
<span><span class="co">#&gt; [37] "rm_latent"                   "name"                       </span></span>
<span><span class="co">#&gt; [39] "get_engine"                  "limits"                     </span></span>
<span><span class="co">#&gt; [41] "get_biascontrol"             "get_projection"             </span></span>
<span><span class="co">#&gt; [43] "plot_bias"                   "offset"                     </span></span>
<span><span class="co">#&gt; [45] "set_biascontrol"             "biodiversity"               </span></span>
<span><span class="co">#&gt; [47] "log"                         "get_offset"                 </span></span>
<span><span class="co">#&gt; [49] "get_offset_type"             "show"                       </span></span>
<span><span class="co">#&gt; [51] "predictors"                  "show_background_info"       </span></span>
<span><span class="co">#&gt; [53] "get_priors"                  "priors"</span></span></code></pre></div>
<p>Now finally the model can be estimated using the supplied engine. The
<code>train</code> function has many available parameters that affect
how the model is being fitted. Unless not possible, the default way is
fitting a linear model based on the provided engine and biodiversity
data types.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="st">"Fit model"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Fit model"</span></span>
<span></span>
<span><span class="co"># Finally train</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>             runname <span class="op">=</span>  <span class="st">"Test INLA run"</span>,</span>
<span>             verbose <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># Don't be chatty</span></span>
<span>             <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="summarizing-and-plotting-the-fitted-distribution-object">Summarizing and plotting the fitted distribution object<a class="anchor" aria-label="anchor" href="#summarizing-and-plotting-the-fitted-distribution-object"></a>
</h3>
<p>As before the created distribution model object can be visualized and
interacted with.</p>
<ul>
<li>
<code><a href="../reference/print.html">print()</a></code> outputs the model, inherent parameters and
whether any predictions are contained within.</li>
<li>
<code><a href="../reference/summary.html">summary()</a></code> creates a summary output of the contained
model.</li>
<li>
<code><a href="../reference/plot.html">plot()</a></code> makes a visualization of prediction over the
background</li>
<li>
<code><a href="../reference/effects.html">effects()</a></code> visualizes the effects, usually the default
plot through the package used to fit the model.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the mean of the posterior predictions</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"mean"</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_train_simple_model_files/figure-html/Plot%20the%20model%20output-1.png" width="960" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Print out some summary statistics</span></span>
<span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 8</span></span></span>
<span><span class="co">#&gt;   variable               mean     sd     q05     q50    q95    mode   kld</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Intercept           -<span style="color: #BB0000;">2.46</span>   0.126  -<span style="color: #BB0000;">2.66</span>   -<span style="color: #BB0000;">2.46</span>   -<span style="color: #BB0000;">2.25</span>  -<span style="color: #BB0000;">2.46</span>       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> bio01_mean_50km     -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">2</span> 0.178  -<span style="color: #BB0000;">0.308</span>  -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">2</span>  0.276 -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">2</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> bio03_mean_50km     -<span style="color: #BB0000;">0.491</span>  0.162  -<span style="color: #BB0000;">0.758</span>  -<span style="color: #BB0000;">0.491</span>  -<span style="color: #BB0000;">0.224</span> -<span style="color: #BB0000;">0.491</span>      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> bio19_mean_50km      0.512  0.120   0.314   0.512   0.709  0.512      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> CLC3_112_mean_50km   0.444  0.070<span style="text-decoration: underline;">2</span>  0.329   0.444   0.560  0.444      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> CLC3_132_mean_50km   0.021<span style="text-decoration: underline;">6</span> 0.059<span style="text-decoration: underline;">8</span> -<span style="color: #BB0000;">0.076</span><span style="color: #BB0000; text-decoration: underline;">8</span>  0.021<span style="text-decoration: underline;">6</span>  0.120  0.021<span style="text-decoration: underline;">6</span>     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> CLC3_211_mean_50km   0.946  0.107   0.771   0.946   1.12   0.946      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> CLC3_312_mean_50km   1.09   0.091<span style="text-decoration: underline;">2</span>  0.943   1.09    1.24   1.09       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> elevation_mean_50km  0.055<span style="text-decoration: underline;">8</span> 0.113  -<span style="color: #BB0000;">0.131</span>   0.055<span style="text-decoration: underline;">8</span>  0.242  0.055<span style="text-decoration: underline;">8</span>     0</span></span>
<span></span>
<span><span class="co"># Show the default effect plot from inlabru</span></span>
<span><span class="fu"><a href="../reference/effects.html">effects</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_train_simple_model_files/figure-html/Plot%20the%20model%20output-2.png" width="960" style="display: block; margin: auto;"></p>
<p>See the reference and help pages for further options including
calculating a <code><a href="../reference/threshold.html">threshold()</a></code>, <code><a href="../reference/partial.html">partial()</a></code> or
<code><a href="../reference/similarity.html">similarity()</a></code> estimate of the used data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># To calculate a partial effect for a given variable</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/partial.html">partial</a></span><span class="op">(</span><span class="va">fit</span>, x.var <span class="op">=</span> <span class="st">"CLC3_312_mean_50km"</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_train_simple_model_files/figure-html/partial%20effect-1.png" width="528" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The object o contains the data underlying this figure</span></span>
<span></span>
<span><span class="co"># Similarly the partial effect can be visualized spatially as 'spartial'</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spartial.html">spartial</a></span><span class="op">(</span><span class="va">fit</span>, x.var <span class="op">=</span> <span class="st">"CLC3_312_mean_50km"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Marginal effect of forest on the relative reporting rate"</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_train_simple_model_files/figure-html/partial%20effect-2.png" width="528" style="display: block; margin: auto;"></p>
<p>It is common practice in species distribution modelling that
resulting predictions are <em>thresholded</em>, e.g. that an abstraction
of the continious prediction is created that separates the background
into areas where the environment supporting a species is presumably
suitable or non-suitable. Threshold can be used in ibis.iSDM via the
<code><a href="../reference/threshold.html">threshold()</a></code> functions suppling either a fitted model, a
RasterLayer or a Scenario object.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Calculate a threshold based on a 50% percentile criterion</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/threshold.html">threshold</a></span><span class="op">(</span><span class="va">fit</span>, method <span class="op">=</span> <span class="st">"percentile"</span>, value <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Notice that this is now indicated in the fit object</span></span>
<span><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Trained INLABRU-Model (Test INLA run)</span></span>
<span><span class="co">#&gt;   <span style="font-weight: 100;">Strongest summary effects:</span></span></span>
<span><span class="co">#&gt;      <span style="color: #0000BB;">Positive:</span> CLC3_312_mean_50km, CLC3_211_mean_50km, bio19_mean_50km, ... (6)</span></span>
<span><span class="co">#&gt;      <span style="color: #BB0000;">Negative:</span> bio01_mean_50km, bio03_mean_50km, Intercept (3)</span></span>
<span><span class="co">#&gt;   Prediction fitted: <span style="color: #00BB00;">yes</span></span></span>
<span><span class="co">#&gt;   Threshold created: <span style="color: #00BB00;">yes</span></span></span>
<span></span>
<span><span class="co"># There is also a convenient plotting function</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="fu">plot_threshold</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_train_simple_model_files/figure-html/Example%20for%20model-based%20thresholding-1.png" width="528" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># It is also possible to use truncated thresholds, which removes non-suitable areas</span></span>
<span><span class="co"># while retaining those that are suitable. These are then normalized to a range of [0-1]</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/threshold.html">threshold</a></span><span class="op">(</span><span class="va">fit</span>, method <span class="op">=</span> <span class="st">"percentile"</span>, value <span class="op">=</span> <span class="fl">0.5</span>, format <span class="op">=</span> <span class="st">"normalize"</span><span class="op">)</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="fu">plot_threshold</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_train_simple_model_files/figure-html/Example%20for%20model-based%20thresholding-2.png" width="528" style="display: block; margin: auto;"></p>
<p><strong>For more options for any of the functions please see the help
pages!</strong></p>
</div>
<div class="section level3">
<h3 id="validation-of-model-predictions">Validation of model predictions<a class="anchor" aria-label="anchor" href="#validation-of-model-predictions"></a>
</h3>
<p>The ibis.iSDM package provides a convenience function to obtain
validation results for the fitted models. Validation can be done both
for continious and discrete predictions, where the latter requires a
computed threshold fits (see above).</p>
<p>Here we will ‘validate’ the fitted model using the data used for
model fitting. For any scientific paper we recommend to implement a
cross-validation scheme to obtain withheld data or use independently
gathered data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># By Default validation statistics are continuous and evaluate the predicted estimates against the number of records per grid cell.</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="fu">rm_threshold</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">fit</span>, method <span class="op">=</span> <span class="st">"cont"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                modelid                 name     method</span></span>
<span><span class="co">#&gt; 1 632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species continuous</span></span>
<span><span class="co">#&gt; 2 632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species continuous</span></span>
<span><span class="co">#&gt; 3 632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species continuous</span></span>
<span><span class="co">#&gt; 4 632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species continuous</span></span>
<span><span class="co">#&gt; 5 632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species continuous</span></span>
<span><span class="co">#&gt; 6 632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species continuous</span></span>
<span><span class="co">#&gt;       metric        value</span></span>
<span><span class="co">#&gt; 1          n 175.00000000</span></span>
<span><span class="co">#&gt; 2       rmse   0.87718846</span></span>
<span><span class="co">#&gt; 3        mae   0.67161198</span></span>
<span><span class="co">#&gt; 4    logloss   1.77282596</span></span>
<span><span class="co">#&gt; 5   normgini  -0.07450199</span></span>
<span><span class="co">#&gt; 6 cont.boyce   0.25959144</span></span>
<span></span>
<span><span class="co"># If the prediction is first thresholded, we can calculate discrete validation estimates (binary being default)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/threshold.html">threshold</a></span><span class="op">(</span><span class="va">fit</span>, method <span class="op">=</span> <span class="st">"percentile"</span>, value <span class="op">=</span> <span class="fl">0.5</span>, format <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">fit</span>, method <span class="op">=</span> <span class="st">"disc"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                 modelid                 name   method</span></span>
<span><span class="co">#&gt; 1  632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species discrete</span></span>
<span><span class="co">#&gt; 2  632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species discrete</span></span>
<span><span class="co">#&gt; 3  632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species discrete</span></span>
<span><span class="co">#&gt; 4  632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species discrete</span></span>
<span><span class="co">#&gt; 5  632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species discrete</span></span>
<span><span class="co">#&gt; 6  632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species discrete</span></span>
<span><span class="co">#&gt; 7  632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species discrete</span></span>
<span><span class="co">#&gt; 8  632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species discrete</span></span>
<span><span class="co">#&gt; 9  632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species discrete</span></span>
<span><span class="co">#&gt; 10 632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species discrete</span></span>
<span><span class="co">#&gt; 11 632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species discrete</span></span>
<span><span class="co">#&gt; 12 632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species discrete</span></span>
<span><span class="co">#&gt; 13 632dab5b-5e26-4cf6-9d65-7534b8abc583 Virtual test species discrete</span></span>
<span><span class="co">#&gt;                 metric       value</span></span>
<span><span class="co">#&gt; 1                    n 525.0000000</span></span>
<span><span class="co">#&gt; 2                  auc   0.7057143</span></span>
<span><span class="co">#&gt; 3     overall.accuracy   0.7733333</span></span>
<span><span class="co">#&gt; 4  true.presence.ratio   0.4251208</span></span>
<span><span class="co">#&gt; 5            precision   0.7333333</span></span>
<span><span class="co">#&gt; 6          sensitivity   0.5028571</span></span>
<span><span class="co">#&gt; 7          specificity   0.9085714</span></span>
<span><span class="co">#&gt; 8                  tss   0.4114286</span></span>
<span><span class="co">#&gt; 9                   f1   0.5966102</span></span>
<span><span class="co">#&gt; 10             logloss   5.9521401</span></span>
<span><span class="co">#&gt; 11   expected.accuracy   0.5904762</span></span>
<span><span class="co">#&gt; 12               kappa   0.4465116</span></span>
<span><span class="co">#&gt; 13         brier.score   0.2266667</span></span></code></pre></div>
<p>Validating integrated SDMs, particular those fitted with multiple
likelihoods is challenging and something that has not yet fully been
explored in the scientific literature. For example strong priors can
substantially improve by modifying the response functions in the model,
but are challenging to validate if the validation data has similar
biases as the training data. One way such SDMs can be validated is
through spatial block validation, where however care needs to be taken
on which datasets are part of which block.</p>
</div>
<div class="section level3">
<h3 id="constrain-a-model-in-prediction-space">Constrain a model in prediction space<a class="anchor" aria-label="anchor" href="#constrain-a-model-in-prediction-space"></a>
</h3>
<p>Species distribution models quite often extrapolate to areas in which
the species are unlikely to persist and thus are more likely to predict
false presences than false absences. This “overprediction” can be caused
by multiple factors from true biological constraints (e.g. dispersal),
to the used algorithm trying to be clever by overfitting towards complex
relationships (In the machine learning literature this problem is
commonly known as the <strong>bias vs variance</strong> tradeoff).</p>
<p>One option to counter this to some extent in SDMs is to add spatial
constraints or <code>spatial latent effects</code>. The underlying
assumption here is that distances in geographic space can to some extent
approximate unknown or unquantified factors that determine a species
range. Other options for constrains is to integrate additional data
sources and add parameter constraints (see [<code>integrate_data</code>]
vignette).</p>
<p>Currently the <code>ibis.iSDM</code> package supports the addition of
only spatial latent effects via <code><a href="../reference/add_latent_spatial.html">add_latent_spatial()</a></code>. See
the help file for more information. Note that not every spatial term
accounts for spatial autocorrelation, some simply add the distance
between observations as predictor (thus assuming that much of the
spatial pattern can be explained by commonalities in the sampling
process).</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we are going to use the xgboost algorithm instead and set as engine below.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to fit two separate Poisson Process Models (PPMs) on presence-only data.</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the predictors again</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">list.files</span>(<span class="fu">system.file</span>(<span class="st">"extdata/predictors/"</span>, <span class="at">package =</span> <span class="st">"ibis.iSDM"</span>), <span class="st">"*.tif"</span>,<span class="at">full.names =</span> <span class="cn">TRUE</span>))</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">subset</span>(predictors, <span class="fu">c</span>(<span class="st">"bio01_mean_50km"</span>,<span class="st">"bio03_mean_50km"</span>,<span class="st">"bio19_mean_50km"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"CLC3_112_mean_50km"</span>,<span class="st">"CLC3_132_mean_50km"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"CLC3_211_mean_50km"</span>,<span class="st">"CLC3_312_mean_50km"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"elevation_mean_50km"</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"koeppen_50km"</span>))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># One of them (Köppen) is a factor, we will now convert this to a true factor variable</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>predictors<span class="sc">$</span>koeppen_50km <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">as.factor</span>(predictors<span class="sc">$</span>koeppen_50km)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a distribution modelling pipeline</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">distribution</span>(background) <span class="sc">|&gt;</span> </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_biodiversity_poipo</span>(virtual_species, <span class="at">field_occurrence =</span> <span class="st">'Observed'</span>, <span class="at">name =</span> <span class="st">'Virtual points'</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictors</span>(predictors, <span class="at">transform =</span> <span class="st">'scale'</span>, <span class="at">derivates =</span> <span class="st">"none"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">engine_xgboost</span>(<span class="at">iter =</span> <span class="dv">8000</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Now train 2 models, one without and one with a spatial latent effect</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>mod_null <span class="ot">&lt;-</span> <span class="fu">train</span>(x, <span class="at">runname =</span> <span class="st">'Normal PPM projection'</span>, <span class="at">only_linear =</span> <span class="cn">TRUE</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co"># And with an added constrain</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculated as nearest neighbour distance (NND) between all input points</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>mod_dist <span class="ot">&lt;-</span> <span class="fu">train</span>(x <span class="sc">|&gt;</span> <span class="fu">add_latent_spatial</span>(<span class="at">method =</span> <span class="st">"nnd"</span>),</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">runname =</span> <span class="st">'PPM with NND constrain'</span>, <span class="at">only_linear =</span> <span class="cn">TRUE</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="sc">|---------</span><span class="er">|</span><span class="sc">---------</span><span class="er">|</span><span class="sc">---------</span><span class="er">|</span><span class="sc">---------</span><span class="er">|</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="er">=========================================</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>                                          </span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare both</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(background, <span class="at">main =</span> <span class="st">"Biodiversity data"</span>); <span class="fu">plot</span>(virtual_species[<span class="st">'Observed'</span>], <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="02_train_simple_model_files/figure-html/Train%20models%20with%20spatial%20constrains-1.png" width="528" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mod_null</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_train_simple_model_files/figure-html/Train%20models%20with%20spatial%20constrains-2.png" width="528" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mod_dist</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_train_simple_model_files/figure-html/Train%20models%20with%20spatial%20constrains-3.png" width="528" style="display: block; margin: auto;">
Another option for constraining a prediction is to place concrete limits
on the prediction surface. This can be done by adding a
<code>factor</code> zone layer to the distribution object. Internally,
it is then assessed in which of the ‘zones’ any biodiversity
observations fall, discarding all others from the prediction. This
approach can be particular suitable for current and future projections
at larger scale using for instance a biome layer as stratification. It
assumes that it is rather unlikely that species distributions shift to
different biomes entirely, for instance because of dispersal or
eco-evolutionary constraints. <strong>Note that this approach
effectively also limits the prediction background / output!</strong></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create again a distribution object, but this time with limits (use the Köppen-geiger layer from above)</span></span>
<span><span class="co"># The zones layer must be a factor layer (e.g. is.factor(layer) )</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">background</span>, limits <span class="op">=</span> <span class="va">predictors</span><span class="op">$</span><span class="va">koeppen_50km</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/add_biodiversity_poipo.html">add_biodiversity_poipo</a></span><span class="op">(</span><span class="va">virtual_species</span>, field_occurrence <span class="op">=</span> <span class="st">'Observed'</span>, name <span class="op">=</span> <span class="st">'Virtual points'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span><span class="va">predictors</span>, transform <span class="op">=</span> <span class="st">'scale'</span>, derivates <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Since we are adding the koeppen layer as zonal layer, we disgard it from the predictors</span></span>
<span>  <span class="fu"><a href="../reference/rm_predictors.html">rm_predictors</a></span><span class="op">(</span><span class="st">"koeppen_50km"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/engine_xgboost.html">engine_xgboost</a></span><span class="op">(</span>iter <span class="op">=</span> <span class="fl">3000</span>, learning_rate <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Spatially limited prediction</span></span>
<span><span class="va">mod_limited</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span><span class="va">x</span>, runname <span class="op">=</span> <span class="st">'Limited prediction background'</span>, only_linear <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare the output</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mod_limited</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_train_simple_model_files/figure-html/Prediction%20limits-1.png" width="528" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Martin Jung.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
