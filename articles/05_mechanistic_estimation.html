<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mechanistic species distribution modelling • ibis.iSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mechanistic species distribution modelling">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ibis.iSDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/01_data_preparationhelpers.html">1. Helper functions to prepare inputs</a></li>
    <li><a class="dropdown-item" href="../articles/02_train_simple_model.html">2. Train a model</a></li>
    <li><a class="dropdown-item" href="../articles/03_integrate_data.html">3. Integrate data</a></li>
    <li><a class="dropdown-item" href="../articles/04_biodiversity_projections.html">4. Biodiversity projections</a></li>
    <li><a class="dropdown-item" href="../articles/05_mechanistic_estimation.html">5. Simulating mechanisms</a></li>
    <li><a class="dropdown-item" href="../articles/06_engine_comparison.html">6. Engine comparison</a></li>
    <li><a class="dropdown-item" href="../articles/07_package_comparison.html">7. Other packages</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/08_frequently-asked-questions.html">FAQ</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/contributing.html">Contributing</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/iiasa/ibis.iSDM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Mechanistic species distribution modelling</h1>
                        <h4 data-toc-skip class="author">Martin
Jung</h4>
            
            <h4 data-toc-skip class="date">2024-08-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/iiasa/ibis.iSDM/blob/dev/vignettes/articles/05_mechanistic_estimation.Rmd" class="external-link"><code>vignettes/articles/05_mechanistic_estimation.Rmd</code></a></small>
      <div class="d-none name"><code>05_mechanistic_estimation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="mechanistic-species-distribution-modelling">Mechanistic species distribution modelling<a class="anchor" aria-label="anchor" href="#mechanistic-species-distribution-modelling"></a>
</h2>
<p>This vignette describes the available options of incorporating
mechanistic modelling approaches in the <em>ibis.iSDM</em> package.
These approaches can broadly be separated as those that are “added” to
existing modelling routines, or how <em>ibis.iSDM</em> outputs can be
used as input in mechanistic modelling. For both this package provides
some basic wrappers.</p>
<p>Before we delve into the options to do mechanistic SDMs in the
<em>ibis.iSDM</em> package, it is useful to remind us what the term
‘mechanism’ actually means. In the literature there are a range of
different definitions, sometimes referring to mechanistic SDMs as those
that incorporate ecological processes (e.g. demography, dispersal,
eco-evolutionary principles). Yet often, correlative SDMs are also
declared “mechanistic” if they somehow incorporate a specific constrain
or response function towards an environmental variable. For example, the
micro-climatic limits to the persistence of a species <a href="https://doi.org/10.1111/gcb.16557" class="external-link">Briscoe et al. 2023</a>, or the
presence of biotic interactions (estimated through a separate SDM of a
different species) are also sometimes referred to as limiting mechanisms
(<a href="https://doi.org/10.1016/j.ecolmodel.2023.110424" class="external-link">Ohlmann et
al. 2023</a>).</p>
<p>The latter approaches - which are largely a fine-tuning of specific
response function - can to some extent be emulated through creating
specific derivates or by adding covariate priors
(<code><a href="../reference/add_priors.html">add_priors()</a></code>) or model predictors
(<code><a href="../reference/add_predictors_model.html">add_predictors_model()</a></code>) to a SDM. Further methods will be
added to the package as they become available or can be readily
incorporated into the modelling framework. Some types of integration can
also be directly modelled through integration. More details are provided
in other vignettes such as the <a href="01_data_preparationhelpers.html">data preparation</a> for creating
derivates or the vignette on <a href="03_integrate_data.html">data
integration</a>. Users of the package are also directed to the various
<code><a href="../reference/add_constraint.html">add_constraint()</a></code> functions, many of which enable
corrections of projected scenarios.</p>
<div class="section level3">
<h3 id="adding-ecological-processes-to-correlative-sdms">Adding ecological processes to correlative SDMs<a class="anchor" aria-label="anchor" href="#adding-ecological-processes-to-correlative-sdms"></a>
</h3>
<p>There are a range of wrappers implemented in <em>ibis.iSDM</em> that
allow a convenient passing of outputs or parameters to other mechanistic
modelling packages. These wrappers support the convenient addition of
ecological processes such as dispersal to scenarios <a href="04_biodiversity_projections.html">data integration</a>. Or they
enable <em>ibis.iSDM</em> outputs to directly become inputs to further
simulations. In case key parameters are not available, package users are
encouraged to check out the various options in the
<code><a href="../reference/add_constraint.html">add_constraint()</a></code> function.</p>
<p>Most of these mechanistic approaches require quite extensive model
understanding and in many cases additional training. Furthermore a range
of parameters are usually required so that outputs are meaningful. It is
beyond the scope of this vignette to provide an introduction to the
various models. Rather, it is only demonstrated how linkages between
<em>ibis.iSDM</em> and other models can be made, and the reader is
referred to the original publication underlying each approach (see help
page for references).</p>
<div class="section level4">
<h4 id="adding-dispersal-to-scenarios-with-kissmig">Adding dispersal to scenarios with <code>KISSMig</code><a class="anchor" aria-label="anchor" href="#adding-dispersal-to-scenarios-with-kissmig"></a>
</h4>
<p>The <em>KISSMig</em> model provide a simple model to estimate and
limit dispersal in species distribution models (<a href="https://doi.org/10.1111/ecog.00930" class="external-link">Nobis &amp; Normand,
2014</a>). It does not include any ecological mechanism related to
recruitment as such, but instead works as a simple stochastic migration
estimator that allows the inclusion of time-lagged dispersal to local
neighborhoods. In the <em>ibis.iSDM</em> package the KISSMig simulator
can be added as a dispersal constraint (among others) to scenario
objects.</p>
<p><em>Example:</em></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://iiasa.github.io/ibis.iSDM/">ibis.iSDM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.7.78</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'terra'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:ibis.iSDM':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     modal</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co"># Don't print out as many messages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"ibis.setupmessages"</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Background and biodiversity data</span></span>
<span><span class="va">background</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/europegrid_50km.tif'</span>, package<span class="op">=</span><span class="st">'ibis.iSDM'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">virtual_points</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/input_data.gpkg'</span>, package<span class="op">=</span><span class="st">'ibis.iSDM'</span><span class="op">)</span>, <span class="st">'points'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Add some pseudo-absence information for later</span></span>
<span><span class="va">poa</span> <span class="op">&lt;-</span> <span class="va">virtual_points</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/add_pseudoabsence.html">add_pseudoabsence</a></span><span class="op">(</span>field_occurrence <span class="op">=</span> <span class="st">'Observed'</span>,</span>
<span>                                           template <span class="op">=</span> <span class="va">background</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note we are loading different predictors than in previous examples</span></span>
<span><span class="co"># These are in netcdf4 format, a format specific for storing spatial-temporal data including metadata.</span></span>
<span><span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/predictors_presfuture/"</span>, package <span class="op">=</span> <span class="st">"ibis.iSDM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"*.nc"</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># From those list of predictors are first loading the current ones as raster data</span></span>
<span><span class="co"># We are loading only data from the very first, contemporary time step for model fitting</span></span>
<span><span class="va">pred_current</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">ll</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span> <span class="va">pred_current</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pred_current</span>, <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">i</span>, lyrs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pred_current</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">ll</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Get future predictors</span></span>
<span><span class="co"># These we will load in some time steps using the stars package and ignoring the first time step</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span> <span class="va">pred_future</span> <span class="op">&lt;-</span> <span class="fu">stars</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html" class="external-link">read_stars</a></span><span class="op">(</span><span class="va">ll</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">stars</span><span class="fu">:::</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/dplyr.html" class="external-link">slice.stars</a></span><span class="op">(</span><span class="st">'Time'</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">86</span>,by<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">pred_future</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span> <span class="co"># Set projection</span></span>
<span><span class="co"># Rename future predictors to those of current</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pred_future</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pred_current</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ------ #</span></span>
<span><span class="co"># Fit a model</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/add_biodiversity_poipa.html">add_biodiversity_poipa</a></span><span class="op">(</span><span class="va">poa</span>, field_occurrence <span class="op">=</span> <span class="st">'Observed'</span>, name <span class="op">=</span> <span class="st">'Virtual points'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Note that we scale the predictors here</span></span>
<span>  <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span><span class="va">pred_current</span>, transform <span class="op">=</span> <span class="st">'scale'</span>,derivates <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/engine_glmnet.html">engine_glmnet</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Train the model</span></span>
<span>  <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Add simple percentile thresholds</span></span>
<span>  <span class="fu"><a href="../reference/threshold.html">threshold</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'percentile'</span>, value <span class="op">=</span> <span class="fl">.33</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show the threshold</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="fu">plot_threshold</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="05_mechanistic_estimation_files/figure-html/Load%20data%20and%20fit%20model-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Now lets add <em>KISSMig</em> as dispersal constraints. The constrain
directly used the fitted suitability estimates from each projected
timestep and also makes use of the created thresholded layer. Per
time-step dispersal events are stochastically simulated and constraint
range expansions in the next modelling steps. See
<code><a href="https://rdrr.io/pkg/kissmig/man/kissmig.html" class="external-link">?kissmig::kissmig</a></code> and the <a href="https://www.wsl.ch/en/services-produkte/kissmig/" class="external-link">help-page</a>
for further help and explanations of parameters.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Create a scenario object</span></span>
<span><span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scenario.html">scenario</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Apply the same variable transformations as above. </span></span>
<span>  <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span><span class="va">pred_future</span>, transform <span class="op">=</span> <span class="st">'scale'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Calculate thresholds at each time step. The threshold estimate is taken from </span></span>
<span>  <span class="co"># the fitted model object.</span></span>
<span>  <span class="fu"><a href="../reference/threshold.html">threshold</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Warning in add_predictors(scenario(fit), pred_future, transform = "scale"):</span></span>
<span><span class="co">#&gt; State variable of transformation not found?</span></span>
<span>  </span>
<span><span class="co"># Add KISSMig constraint</span></span>
<span><span class="va">sc1</span> <span class="op">&lt;-</span> <span class="va">sc</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/add_constraint_dispersal.html">add_constraint_dispersal</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"kissmig"</span>,</span>
<span>                           type <span class="op">=</span> <span class="st">"DIS"</span>, <span class="co"># Final distribution result</span></span>
<span>                           value <span class="op">=</span> <span class="fl">10</span>, <span class="co"># Number of iteration steps</span></span>
<span>                           <span class="co"># These parameters are for KISSMig and get passed on</span></span>
<span>                           <span class="co"># Probablitiy of local extinction between iterations</span></span>
<span>                           pext <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                           <span class="co"># Probability corner cells are colonized.</span></span>
<span>                           pcor <span class="op">=</span> <span class="fl">0.2</span></span>
<span>                           <span class="op">)</span></span>
<span></span>
<span><span class="va">sc2</span> <span class="op">&lt;-</span> <span class="va">sc</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/add_constraint_dispersal.html">add_constraint_dispersal</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"kissmig"</span>,</span>
<span>                           type <span class="op">=</span> <span class="st">"DIS"</span>, <span class="co"># Final distribution result</span></span>
<span>                           value <span class="op">=</span> <span class="fl">10</span>, <span class="co"># Number of iteration steps</span></span>
<span>                           <span class="co"># These parameters are for KISSMig and get passed on</span></span>
<span>                           <span class="co"># Probablitiy of local extinction between iterations</span></span>
<span>                           pext <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>                           <span class="co"># Probability corner cells are colonized.</span></span>
<span>                           pcor <span class="op">=</span> <span class="fl">0.1</span></span>
<span>                           <span class="op">)</span></span>
<span></span>
<span><span class="co"># Project two scenarios with varying local extinction probability</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="va">sc1</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is FALSE</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="va">sc2</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">df1</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"low"</span><span class="op">)</span>,</span>
<span>                       <span class="va">df2</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"high"</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co"># ------ #</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">band</span>, y<span class="op">=</span> <span class="va">area_km2</span><span class="op">/</span><span class="fl">1e6</span>,</span>
<span>               group <span class="op">=</span> <span class="va">scenario</span>, color <span class="op">=</span> <span class="va">scenario</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Occupied area (Million km2)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="05_mechanistic_estimation_files/figure-html/KISSMig%20dispersal%20simulation-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="adding-dispersal-to-scenarios-with-migclim">Adding dispersal to scenarios with <code>MIGCLIM</code><a class="anchor" aria-label="anchor" href="#adding-dispersal-to-scenarios-with-migclim"></a>
</h4>
<p>Another dispersal simulator is MIGCLIM (<a href="https://onlinelibrary.wiley.com/doi/full/10.1111/j.1600-0587.2012.07608.x" class="external-link">Engler
et al. 2014</a>), a stochastic simulator which innovatively allows to
differentiate between short and long-distance dispersal events as well
as varying propagule pressure. Unfortunately is currently not available
on CRAN anymore (stand September 2023), possibly because of lack of
maintenance or missing dependency. The package can still be downloaded
from github however (<a href="https://github.com/robinengler/MigClim/" class="external-link">https://github.com/robinengler/MigClim/</a>).</p>
<p>Assuming the user is able to install the MigClim package with all
it’s dependencies (some of which have also disappared from CRAN), it can
be run in <em>ibis.iSDM</em> as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scenario.html">scenario</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Apply the same variable transformations as above. </span></span>
<span>  <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span><span class="va">pred_future</span>, transform <span class="op">=</span> <span class="st">'scale'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Calculate thresholds at each time step. The threshold estimate is taken from </span></span>
<span>  <span class="co"># the fitted model object.</span></span>
<span>  <span class="fu"><a href="../reference/threshold.html">threshold</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span><span class="co"># Check the help files for the function for an explanation of the parameters.</span></span>
<span>  <span class="fu"><a href="../reference/add_constraint_MigClim.html">add_constraint_MigClim</a></span><span class="op">(</span>rcThresholdMode <span class="op">=</span> <span class="st">'continuous'</span>,</span>
<span>                         dispSteps <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         dispKernel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.4</span>, <span class="fl">0.16</span>, <span class="fl">0.06</span>, <span class="fl">0.03</span><span class="op">)</span>,</span>
<span>                         barrierType <span class="op">=</span> <span class="st">"strong"</span>,</span>
<span>                         lddFreq <span class="op">=</span> <span class="fl">0</span>, lddRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10000</span><span class="op">)</span>,</span>
<span>                         iniMatAge <span class="op">=</span> <span class="fl">1</span>, propaguleProdProb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.6</span>,<span class="fl">0.8</span>, <span class="fl">0.95</span><span class="op">)</span>,</span>
<span>                         replicateNb <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Project the model</span></span>
<span>  <span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># MIGCLIM outputs are provided a single updated layer and can be plotted through</span></span>
<span><span class="co"># a customized plotting function.</span></span>
<span><span class="va">prj</span><span class="op">$</span><span class="fu">plot_migclim</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><em>This example will be updated as an update for current R versions
(&gt;3.0) becomes available.</em></p>
</div>
<div class="section level4">
<h4 id="simulating-spatial-explicit-population-abundance-with-steps">Simulating spatial-explicit population abundance with
<code>steps</code><a class="anchor" aria-label="anchor" href="#simulating-spatial-explicit-population-abundance-with-steps"></a>
</h4>
<p>The <em>steps</em> package implements a spatial-temporal explicit
metapopulation simulator (<a href="https://doi.org/10.1111/2041-210X.13354" class="external-link">Visintin et al. 2021</a>)
that is able to account for varying vital rates, dispersal with barriers
and density dependence. <em>steps</em> is a simulator, thus makes use of
a range of parameters and critical correlative assumptions to estimate
for example abundance of a given time step.</p>
<p>In the <em>ibis.iSDM</em> package the linkage to <em>steps</em> can
be established directly in the scenario projections by simply adding it
as a separate module. When added, steps is used to make spatial-temporal
abundance estimates that are aligned with each projection time step,
eventual specified barriers and the provided parameters with regards to
vital rates and density-dependence.</p>
<p><strong>Note:</strong> The wrapper functionality implemented in the
<em>ibis.iSDM</em> package is based on the assumption that higher
habitat suitability (as estimated by a correlative SDM) is linearly
correlated to higher population abundance. It should be noted that such
assumptions have been questioned before and should be interpreted with
caution (<a href="https://doi.org/10.1111/ecog.05877" class="external-link">Lee-Yaw et
al. 2021</a>).</p>
<p><strong>Users should always clearly understand the rationale behind
parameter choices!</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="st">"steps"</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/steps-dev/steps" class="external-link">"steps"</a></span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Define some arbitrary vital rates for the transition for this purpose</span></span>
<span>  <span class="co"># Define vital rates</span></span>
<span>  <span class="va">vt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>,<span class="fl">0.52</span>,<span class="fl">0.75</span>,</span>
<span>                <span class="fl">0.52</span>,<span class="fl">0.28</span>,<span class="fl">0.0</span>,</span>
<span>                <span class="fl">0.0</span>,<span class="fl">0.52</span>,<span class="fl">0.75</span><span class="op">)</span>,</span>
<span>                nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vt</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">vt</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'juvenile'</span>,<span class="st">'subadult'</span>,<span class="st">'adult'</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># We again specify a scenario as before using the fitted model</span></span>
<span>  <span class="va">prj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scenario.html">scenario</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co"># Apply the same variable transformations as above. </span></span>
<span>    <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span><span class="va">pred_future</span>, transform <span class="op">=</span> <span class="st">'scale'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co"># Calculate thresholds at each time step. The threshold estimate is taken from </span></span>
<span>    <span class="co"># the fitted model object.</span></span>
<span>    <span class="fu"><a href="../reference/threshold.html">threshold</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co"># We then specify that we we </span></span>
<span>    <span class="fu"><a href="../reference/simulate_population_steps.html">simulate_population_steps</a></span><span class="op">(</span>vital_rates <span class="op">=</span> <span class="va">vt</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Notice how we have added steps as additional simulation outcome</span></span>
<span>  <span class="va">prj</span></span>
<span>  <span class="co"># Now project</span></span>
<span>  <span class="va">scenario1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="va">prj</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">scenario1</span>, <span class="st">"population"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Also see a different one where we add a dispersal constraint and density dependence</span></span>
<span>  <span class="va">dispersal</span> <span class="op">&lt;-</span> <span class="fu">steps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/steps/man/fast_dispersal.html" class="external-link">fast_dispersal</a></span><span class="op">(</span>dispersal_kernel <span class="op">=</span> <span class="fu">steps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/steps/man/exponential_dispersal_kernel.html" class="external-link">exponential_dispersal_kernel</a></span><span class="op">(</span>distance_decay <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">scenario2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project.html">project</a></span><span class="op">(</span><span class="va">prj</span> <span class="op">|&gt;</span></span>
<span>                         <span class="fu"><a href="../reference/simulate_population_steps.html">simulate_population_steps</a></span><span class="op">(</span><span class="va">vt</span>,</span>
<span>                                                   dispersal <span class="op">=</span> <span class="va">dispersal</span>,</span>
<span>                                                   density_dependence <span class="op">=</span> <span class="fu">steps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/steps/man/ceiling_density.html" class="external-link">ceiling_density</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># We can see that the dispersal constraint and higher density dependence cleary</span></span>
<span>  <span class="co"># results in a population abundance that tends to be concentrated in central Europe.</span></span>
<span>  <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">scenario2</span>, <span class="st">"population"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Loading required package: steps</span></span>
<span><span class="co">#&gt; Warning in add_predictors(scenario(fit), pred_future, transform = "scale"):</span></span>
<span><span class="co">#&gt; State variable of transformation not found?</span></span></code></pre></div>
<p><img src="05_mechanistic_estimation_files/figure-html/steps-1.png" width="700" style="display: block; margin: auto;"><img src="05_mechanistic_estimation_files/figure-html/steps-2.png" width="700" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Jung.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
