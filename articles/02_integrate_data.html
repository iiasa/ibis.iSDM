<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ibis.iSDM">
<title>Data integration • ibis.iSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data integration">
<meta property="og:description" content="ibis.iSDM">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@Martin_Ecology">
<meta name="twitter:site" content="@IIASAVienna">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ibis.iSDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/01_train_simple_model.html">1. Train a model</a>
    <a class="dropdown-item" href="../articles/02_integrate_data.html">2. Integrate data</a>
    <a class="dropdown-item" href="../articles/03_biodiversity_projections.html">3. Biodiversity projections</a>
    <a class="dropdown-item" href="../articles/04_mechanistic_estimation.html">4. Simulating mechanisms</a>
    <a class="dropdown-item" href="../articles/05_engine_comparison.html">5. Engine comparison</a>
    <a class="dropdown-item" href="../articles/06_package_comparison.html">6. Other packages</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/07_frequently-asked-questions.html">FAQ</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/contributing.html">Contributing</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/iiasa/ibis.iSDM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Data integration</h1>
                        <h4 data-toc-skip class="author">Martin
Jung</h4>
            
            <h4 data-toc-skip class="date">2023-08-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/iiasa/ibis.iSDM/blob/HEAD/vignettes/articles/02_integrate_data.Rmd" class="external-link"><code>vignettes/articles/02_integrate_data.Rmd</code></a></small>
      <div class="d-none name"><code>02_integrate_data.Rmd</code></div>
    </div>

    
    
<p>One of the key ambitions of the <code>ibis.iSDM</code> R-package is
to provide a comprehensive framework for model-based integration of
different biodiversity datasets and parameters. As ‘integration’ in the
context of SDMs we generally refer to as any approach where additional
observational data or parameters find their way into model estimation.
The purpose behind the integration can be:</p>
<ul>
<li>to correct for certain biases (spatial, environmental) in the
primary dataset, taking advantage of different types of biodiversity
sampling schemes.</li>
<li>nudge data-driven algorithms towards estimates that are informed by
domain knowledge (through offsets or priors) rather than letting the
algorithm making naive uniformly distributed guesses.</li>
<li>to provide a more wholesome estimate of the distribution of a
species distribution by relying on multiple sources of evidence.
Particular when there are multiple surveys that complement each
other.</li>
</ul>
<p>There are thus multiple types of integration and we recommend to have
a look at <a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/ecy.2710" class="external-link">Fletcher
et al. (2019)</a> and <a href="https://linkinghub.elsevier.com/retrieve/pii/S0169534719302551" class="external-link">Isaac
et al. (2020)</a> for an overview.</p>
<p>The <a href="05_package_comparison.html">Package comparison page</a>
and the examples below provide some insight into what is currently
possible with regards to data integration in the ibis.iSDM R-package.
Additional methods, priors and engines are planned. Of course it is
equally possible to ‘integrate’ not only observational data and
parameters, but link entire models with ibis.iSDM outputs. More on this
in the scenario help page.</p>
<div class="section level2">
<h2 id="load-relevant-packages-and-testing-data">Load relevant packages and testing data<a class="anchor" aria-label="anchor" href="#load-relevant-packages-and-testing-data"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://iiasa.github.io/ibis.iSDM/">ibis.iSDM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.inlabru.org" class="external-link">inlabru</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu" class="external-link">glmnet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmlc/xgboost" class="external-link">xgboost</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">assertthat</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Don't print out as many messages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"ibis.setupmessages"</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Lets load some of the prepared test data for this exercise. This time
we are going to make use of several datasets.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Background layer</span></span>
<span><span class="va">background</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/europegrid_50km.tif"</span>,package <span class="op">=</span> <span class="st">"ibis.iSDM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Load virtual species points</span></span>
<span><span class="va">virtual_species</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/input_data.gpkg"</span>,package <span class="op">=</span> <span class="st">"ibis.iSDM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"points"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="va">virtual_range</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/input_data.gpkg'</span>, package<span class="op">=</span><span class="st">'ibis.iSDM'</span><span class="op">)</span>, <span class="st">'range'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In addition we will use the species data to generate a presence-absence dataset with pseudo-absence points.</span></span>
<span><span class="co"># Here we first specify the settings to use:</span></span>
<span><span class="va">ass</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pseudoabs_settings.html">pseudoabs_settings</a></span><span class="op">(</span>background <span class="op">=</span> <span class="va">background</span>, nrpoints <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                          method <span class="op">=</span>  <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="va">virtual_pseudoabs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_pseudoabsence.html">add_pseudoabsence</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">virtual_species</span>, field_occurrence <span class="op">=</span> <span class="st">"Observed"</span>,</span>
<span>                                       settings <span class="op">=</span> <span class="va">ass</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predictors</span></span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/predictors/"</span>, package <span class="op">=</span> <span class="st">"ibis.iSDM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"*.tif"</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Make use only of a few of them</span></span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">predictors</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01_mean_50km"</span>,<span class="st">"bio03_mean_50km"</span>,<span class="st">"bio19_mean_50km"</span>,</span>
<span>                                            <span class="st">"CLC3_112_mean_50km"</span>,<span class="st">"CLC3_132_mean_50km"</span>,</span>
<span>                                            <span class="st">"CLC3_211_mean_50km"</span>,<span class="st">"CLC3_312_mean_50km"</span>,</span>
<span>                                            <span class="st">"elevation_mean_50km"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can define a generic model to use for any of the sections
below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First define a generic model and engine using the available predictors</span></span>
<span><span class="va">basemodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span>env <span class="op">=</span> <span class="va">predictors</span>, transform <span class="op">=</span> <span class="st">"scale"</span>, derivates <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/engine_inlabru.html">engine_inlabru</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="integration-through-predictors">Integration through predictors<a class="anchor" aria-label="anchor" href="#integration-through-predictors"></a>
</h2>
<p>The most simple way of integrating prior observations into species
distribution models is to add them as covariate. This is based on the
assumption that for instance an expert-drawn range map can be useful in
predicting where species exist might or might not find suitable habitat
(see for instance <a href="http://doi.wiley.com/10.1111/ecog.01925" class="external-link">Domisch et al. 2016</a>).
A benefit of this approach is that predictors can be easily added to all
kinds of <code>engines</code> in the ibis.ISDM package and also used for
scenarios.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Here we simply add the range as simple binary predictor</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="va">basemodel</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="../reference/add_predictor_range.html">add_predictor_range</a></span><span class="op">(</span><span class="va">virtual_range</span>, method <span class="op">=</span> <span class="st">"distance"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We can see that the range has been added to the predictors object</span></span>
<span><span class="co"># 'distance_range'</span></span>
<span><span class="va">mod1</span><span class="op">$</span><span class="fu">get_predictor_names</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "bio01_mean_50km"     "bio03_mean_50km"     "bio19_mean_50km"    </span></span>
<span><span class="co">#&gt; [4] "CLC3_112_mean_50km"  "CLC3_132_mean_50km"  "CLC3_211_mean_50km" </span></span>
<span><span class="co">#&gt; [7] "CLC3_312_mean_50km"  "elevation_mean_50km" "distance_range"</span></span></code></pre></div>
<p>Expert-ranges can currently be added as simple <code>binary</code> or
<code>distance</code> transform. For the latter more options are
available in the <code>bossMaps</code> R-package as described in <a href="http://doi.wiley.com/10.1111/geb.12539" class="external-link">Merow et al. 2017</a>.</p>
<p>Another option that has been added is the possibility to add
thresholded masks based on some elevational (or other) limits. The idea
here is to generate two layers, one with areas between a lower and an
upper range and one above the upper range. Regression against such
thresholded layers can thus approximate the lower and upper bounds. For
instance suppose a species is known to occur between 300 and 800m above
sea level, this can be added as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specification </span></span>
<span><span class="va">basemodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span>env <span class="op">=</span> <span class="va">predictors</span>, transform <span class="op">=</span> <span class="st">"scale"</span>, derivates <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>  <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/engine_inlabru.html">engine_inlabru</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="va">basemodel</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/add_predictor_elevationpref.html">add_predictor_elevationpref</a></span><span class="op">(</span>layer <span class="op">=</span> <span class="va">predictors</span><span class="op">$</span><span class="va">elevation_mean_50km</span>,</span>
<span>                              lower <span class="op">=</span> <span class="fl">300</span>, upper <span class="op">=</span> <span class="fl">800</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the threshold for an upper</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span> <span class="va">mod1</span><span class="op">$</span><span class="va">predictors</span><span class="op">$</span><span class="fu">get_data</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"elev_low"</span>, <span class="st">"elev_high"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">)</span></span></code></pre></div>
<p><img src="02_integrate_data_files/figure-html/add%20elevation%20as%20predictor-1.png" width="700" style="display: block; margin: auto;"></p>
<hr>
</div>
<div class="section level2">
<h2 id="integration-through-offsets">Integration through offsets<a class="anchor" aria-label="anchor" href="#integration-through-offsets"></a>
</h2>
<p>Apart from including spatial-explicit prior biodiversity knowledge as
predictors in a SDM model, there is - particular for Poisson Process
Models (PPM) - also a different approach, that is to include the
variable as offset in the prediction. Doing so effectively tells the
respective engine to change intercepts and coefficients based on
existing knowledge, which can for instance be an existing coefficient.
Offsets can be specified as addition or as nuisance for a model, for
instance either by adding an expert-delineated range as offset or by
factoring out the spatial bias of areas with high sampling density or
accessibility. Multiple offsets can be specified for any given PPM by
simply multiplying them, since <span class="math inline">\(log(off_1 *
off_2) = log(off_1) + log(off_2)\)</span>. A comprehensive overview of
including offsets in SDMs can be found in <a href="http://doi.wiley.com/10.1111/geb.12453" class="external-link">Merow et
al. (2016)</a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Specification </span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span>  <span class="op">|&gt;</span>  </span>
<span>      <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span>env <span class="op">=</span> <span class="va">predictors</span>, transform <span class="op">=</span> <span class="st">"scale"</span>, derivates <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>  <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/add_biodiversity_poipo.html">add_biodiversity_poipo</a></span><span class="op">(</span><span class="va">virtual_species</span>,field_occurrence <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>      <span class="fu"><a href="../reference/add_offset_range.html">add_offset_range</a></span><span class="op">(</span><span class="va">virtual_range</span>, distance_max <span class="op">=</span> <span class="fl">5e5</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>      <span class="fu"><a href="../reference/engine_glmnet.html">engine_glmnet</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="co"># Train</span></span>
<span>  <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span>runname <span class="op">=</span> <span class="st">"Prediction with range offset"</span>,only_linear <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_integrate_data_files/figure-html/Train%20model%20with%20range%20offset-1.png" width="700" style="display: block; margin: auto;"></p>
<p>There are other ways to add offsets to the model object, either
directly (<code><a href="../reference/add_offset.html">add_offset()</a></code>) as an externally calculated
RasterLayer for instance with the “BossMaps” R-package, to calculate as
range (<code><a href="../reference/add_offset_range.html">add_offset_range()</a></code>) or elevation
(<code><a href="../reference/add_offset_elevation.html">add_offset_elevation()</a></code>) offset, or also as biased offset
(<code><a href="../reference/add_offset_bias.html">add_offset_bias()</a></code>) in which case the offset is removed
from the prediction.</p>
<hr>
</div>
<div class="section level2">
<h2 id="integration-with-priors">Integration with priors<a class="anchor" aria-label="anchor" href="#integration-with-priors"></a>
</h2>
<p>A different type of integration is also possible through the use of
informed priors, which can be set on fixed or random effects in the
model. In a Bayesian context a prior is generally understood as some
form of uncertain quantity that is meant to reflect the direction and/or
magnitude of model parameters and is usually known a-priori to any
inference or prediction. Offsets can also be understood as “priors”,
however in the context of SDMs, they are usually included as
spatial-explicit data, opposed to priors that are only available in
tabular form (such as known habitat affiliations). Since the ibis.iSDM
package supports a variety of engines and not all of them are Bayesian
in a strict sense (such as <code>engine_gdb</code> or
<code>engine_xgboost</code>), the specification of priors differs
depending on the engine in question.</p>
<p>Generally [<code>Prior-class</code>] objects can be grouped into:</p>
<ul>
<li><p>Probabilistic priors with estimates placed on for example the
mean (<span class="math inline">\(\mu\)</span>) and standard deviation
(<span class="math inline">\(\sigma\)</span>) or precision in the case
of [<code>engine_inla</code>]. Such priors usually allow the greatest
amount of flexibility since they are able to incorporate information on
both the sign and magnitude of a coefficient.</p></li>
<li><p>Monotonic constraints on the direction of a coefficient and
predictor in the model, such that is <span class="math inline">\(f(x_1)
&gt;= f(x_2)\)</span> or <span class="math inline">\(f(x_1) &lt;=
f(x_2)\)</span>. Useful to incorporate for instance prior ecological
knowledge on that a certain response function for example has to be
positive.</p></li>
<li><p>More complex priors specified on random spatial effects such as
penalized complexity priors used for SPDE effects in
[<code><a href="../reference/add_latent_spatial.html">add_latent_spatial()</a></code>].</p></li>
<li><p>Probabilistic priors on the inclusion probability of a certain
variable such as to what certainty the variable should or should not be
included in a regularized outcome. For example used in the case of
[<code>engine_breg</code>] or [<code>engine_glmnet</code>].</p></li>
</ul>
<p>Prior specifications are specific to each engine and more information
can be found on the individual help pages of the <code><a href="../reference/priors.html">priors()</a></code>
function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Set a clean base model with biodiversity data</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span>env <span class="op">=</span> <span class="va">predictors</span>, transform <span class="op">=</span> <span class="st">"scale"</span>, derivates <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/add_biodiversity_poipo.html">add_biodiversity_poipo</a></span><span class="op">(</span><span class="va">virtual_species</span>, field_occurrence <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>      <span class="fu"><a href="../reference/engine_inlabru.html">engine_inlabru</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a first model</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span><span class="va">x</span>, only_linear <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now assume we now that the species occurs more likely in intensively farmed land. </span></span>
<span><span class="co"># We can use this information to construct a prior for the linear coefficient.</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/INLAPrior.html">INLAPrior</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="st">"CLC3_211_mean_50km"</span>,</span>
<span>               type <span class="op">=</span> <span class="st">"normal"</span>,</span>
<span>               hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1000</span><span class="op">)</span> <span class="co"># Precision priors, thus larger sigmas indicate higher precision</span></span>
<span>               <span class="op">)</span></span>
<span><span class="co"># Single/Multiple priors need to be passed to `priors` and then added to the model object.</span></span>
<span><span class="va">pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/priors.html">priors</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co"># The variables and values in this object can be queried as well</span></span>
<span><span class="va">pp</span><span class="op">$</span><span class="fu">varnames</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0c5b8a86-79a6-464b-8e28-c763c7d5e598 </span></span>
<span><span class="co">#&gt;                 "CLC3_211_mean_50km"</span></span>
<span></span>
<span><span class="co"># Priors can then be added via </span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span><span class="va">x</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/add_priors.html">add_priors</a></span><span class="op">(</span><span class="va">pp</span><span class="op">)</span>, only_linear <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Or alternatively directly as parameter via add_predictors,</span></span>
<span><span class="co"># e.g. add_predictors(env = predictors, priors = pp)</span></span>
<span></span>
<span><span class="co"># Compare the difference in effects</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/partial.html">partial</a></span><span class="op">(</span><span class="va">mod1</span>, <span class="va">pp</span><span class="op">$</span><span class="fu">varnames</span><span class="op">(</span><span class="op">)</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_integrate_data_files/figure-html/Specification%20of%20priors-1.png" width="528" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/partial.html">partial</a></span><span class="op">(</span><span class="va">mod2</span>, <span class="va">pp</span><span class="op">$</span><span class="fu">varnames</span><span class="op">(</span><span class="op">)</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_integrate_data_files/figure-html/Specification%20of%20priors-2.png" width="528" style="display: block; margin: auto;"></p>
<p>There is also now a convenience function that allows to extract
coefficients or weights from an existing model when can then be passed
to another model or engine (<code><a href="../reference/get_priors.html">get_priors()</a></code>). Only requirement
is that a fitted model is provided as well as the target engine for
which coefficients/priors are to be created.</p>
<hr>
</div>
<div class="section level2">
<h2 id="integration-with-ensembles">Integration with ensembles<a class="anchor" aria-label="anchor" href="#integration-with-ensembles"></a>
</h2>
<p>Another very straight forward way for model-based integration is to
simply fit two separate models each with a different biodiversity
dataset and then create an ensemble from them. This approach also works
across different engines and a variety of data types (in some cases
requiring normalization given the difference in units and model
assumptions). (Note that it also possible to create an ensemble of
partial responses via <code><a href="../reference/ensemble_partial.html">ensemble_partial()</a></code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create and fit two models</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>      <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span>env <span class="op">=</span> <span class="va">predictors</span>, transform <span class="op">=</span> <span class="st">"scale"</span>, derivates <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/engine_glmnet.html">engine_glmnet</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="co"># Add dataset 1 </span></span>
<span>      <span class="fu"><a href="../reference/add_biodiversity_poipo.html">add_biodiversity_poipo</a></span><span class="op">(</span>poipo <span class="op">=</span> <span class="va">virtual_species</span>, name <span class="op">=</span> <span class="st">"Dataset1"</span>,field_occurrence <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span>runname <span class="op">=</span> <span class="st">"Test1"</span>, only_linear <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>      <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span>env <span class="op">=</span> <span class="va">predictors</span>, transform <span class="op">=</span> <span class="st">"scale"</span>, derivates <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="../reference/engine_xgboost.html">engine_xgboost</a></span><span class="op">(</span>iter <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>      <span class="co"># Add dataset 2, Here we simple simulate presence-only points from a range</span></span>
<span>      <span class="fu"><a href="../reference/add_biodiversity_polpo.html">add_biodiversity_polpo</a></span><span class="op">(</span><span class="va">virtual_range</span>, name <span class="op">=</span> <span class="st">"Dataset2"</span>,field_occurrence <span class="op">=</span> <span class="st">"Observed"</span>,</span>
<span>                             simulate <span class="op">=</span> <span class="cn">TRUE</span>,simulate_points <span class="op">=</span> <span class="fl">300</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>      <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span>runname <span class="op">=</span> <span class="st">"Test1"</span>, only_linear <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show outputs of each model individually and combined</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_integrate_data_files/figure-html/Model%20ensembles-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_integrate_data_files/figure-html/Model%20ensembles-2.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Now create an ensemble:</span></span>
<span><span class="co"># By setting normalize to TRUE we furthermore ensure each prediction</span></span>
<span><span class="co"># is on a comparable scale [0-1].</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ensemble.html">ensemble</a></span><span class="op">(</span><span class="va">mod1</span>, <span class="va">mod2</span>, method <span class="op">=</span> <span class="st">"mean"</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The ensemble contains the mean and the coefficient of variation across all objects</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_integrate_data_files/figure-html/Model%20ensembles-3.png" width="700" style="display: block; margin: auto;"></p>
<hr>
</div>
<div class="section level2">
<h2 id="combined-and-joint-likelihood-estimation">Combined and joint likelihood estimation<a class="anchor" aria-label="anchor" href="#combined-and-joint-likelihood-estimation"></a>
</h2>
<p>In the examples above we always added only a single biodiversity data
source to a model to be trained, but what if we add multiple different
ones? As outlined by <a href="https://linkinghub.elsevier.com/retrieve/pii/S0169534719302551" class="external-link">Isaac
et al. 2020</a> joint, model-based integration of different data sources
allows to borrow strengths of different types of datasets (quantity,
quality) for more accurate parameter estimations as well as the control
of biases. Particular for SDMs it also has the benefit of avoiding to
make unreasonable assumptions about the absence of a species, as
commonly being done through the addition of pseudo-absences (despite
being called pseudo, any logistic likelihood function treats them as
<em>true</em> absence).</p>
<p>Depending on the engine, the ibis.iSDM package currently supports
either combined or joint estimation of several datasets.</p>
<div class="section level4">
<h4 id="combined-integration">Combined integration<a class="anchor" aria-label="anchor" href="#combined-integration"></a>
</h4>
<p>By default all engines that do not support any joint estimation (see
below) will make use of a combined integration, for which there are
currently three different options:</p>
<ul>
<li><p>“predictor”: The predicted output of the first (or previously
fitted) models are added to the predictor stack and thus are predictors
for subsequent models (Default).</p></li>
<li><p>“offset”: The predicted output of the first (or previously
fitted) models are added as spatial offsets to subsequent models.
Offsets are back-transformed depending on the model family. This might
not work for all likelihood functions and engines!</p></li>
<li><p>“prior”: In this option we only make use of the coefficients from
a previous model to define priors to be used in the next model. Note
that this option creates priors based on previous fits and can result in
unreasonable constrains (particular if coefficients are driven largely
by latent variables). Can be used in projections
(<code><a href="../reference/scenario.html">scenario()</a></code>).</p></li>
<li><p>“interaction”: In the case of two datasets of the same type it
also is possible to make use of factor interactions. In this case the
prediction is made based on the first reference level (e.g. the first
added dataset) with the others being “partialed” out during prediction.
This method only works if one fits a model with multiple datasets on the
same response (e.g. Bernoulli distributed). Can be used in projections
(<code><a href="../reference/scenario.html">scenario()</a></code>).</p></li>
<li><p>“weights”: This type of integration works only for two
biodiversity datasets of the same type. Here the datasets are combined
into one, however the observations are weighted through a
<code>weights</code> parameter in each add_biodiversity call. This can
be for example used to give one dataset an arbitrary (or expert-defined)
higher value compared to another.</p></li>
</ul>
<p>All of these can be specified as parameter in
<code><a href="../reference/train.html">train()</a></code>.</p>
<p><b>Note that for any of these methods (like “predictor” &amp;
“offset”), models are trained in the sequence at which datasets are
added!</b></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specification </span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>      <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span>env <span class="op">=</span> <span class="va">predictors</span>, transform <span class="op">=</span> <span class="st">"scale"</span>, derivates <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co"># A presence only dataset</span></span>
<span>      <span class="fu"><a href="../reference/add_biodiversity_poipo.html">add_biodiversity_poipo</a></span><span class="op">(</span><span class="va">virtual_species</span>,field_occurrence <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>    <span class="co"># A Presence absence dataset</span></span>
<span>      <span class="fu"><a href="../reference/add_biodiversity_poipa.html">add_biodiversity_poipa</a></span><span class="op">(</span><span class="va">virtual_pseudoabs</span>,field_occurrence <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>      <span class="fu"><a href="../reference/engine_xgboost.html">engine_xgboost</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Train</span></span>
<span>  <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span>runname <span class="op">=</span> <span class="st">"Combined prediction"</span>,only_linear <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        method_integration <span class="op">=</span> <span class="st">"predictor"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The resulting object contains only the final prediction, e.g. that of the presence-absence model</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_integrate_data_files/figure-html/Combined%20integration-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="joint-likelihood-estimation">Joint likelihood estimation<a class="anchor" aria-label="anchor" href="#joint-likelihood-estimation"></a>
</h4>
<p>Some engines, notably [<code>engine_inla</code>],
[<code>engine_inlabru</code>] and [<code>engine_stan</code>] support the
joint estimation of multiple likelihoods. The algorithmic approach in
this package generally follows an approach outlined where any
presence-only datasets are modelled through a log-Gaussian Cox process
where the expected number of individuals are estimated as a function of
area <span class="math inline">\(A\)</span> following a Poisson
distribution:</p>
<p><span class="math display">\[\begin{align*}
N(A) &amp;\sim {\sf Poisson}\left(\int_{A} \lambda(i)\right) \\
\end{align*}\]</span> <span class="math display">\[\begin{align*}
\log(\lambda(i)) = \alpha_{1} + \sum_{k}^{K} \beta_{k}x_{i}
\end{align*}\]</span></p>
<p>where <span class="math inline">\(N\)</span> is the number of
individuals, <span class="math inline">\(A\)</span> the Area for a given
spatial unit <span class="math inline">\(i\)</span>, with <span class="math inline">\(N(A)\)</span> being an estimate of the relative
rate of occurrence per unit area (or ROR). <span class="math inline">\(k\)</span> is an increment for <span class="math inline">\(K\)</span> number of predictors. <span class="math inline">\(\lambda\)</span> is the intensity function, <span class="math inline">\(\alpha\)</span> the intercept and <span class="math inline">\(\beta\)</span> the parameter coefficients for
environmental covariates. Note that for interactions</p>
<p>Presence-absence data are estimated as draws from a
<em>Bernoulli</em> distribution:</p>
<p><span class="math display">\[\begin{align*}
Y_{i} &amp;\sim {\sf Bernoulli(p_{i})}, i = 1, 2, ... \\
\end{align*}\]</span> <span class="math display">\[\begin{align*}
\log(-\log(1-p_{i})) &amp;= \alpha_{2} + \sum_{k}^{K} \beta_{k}x_{i}
\end{align*}\]</span></p>
<p>where <span class="math inline">\(Y\)</span> is the presence-absence
of an record (usually a standardized survey) as sampled from a
<em>Bernoulli</em> distribution in a given spatial unit <span class="math inline">\(i\)</span>. <span class="math inline">\(\alpha\)</span> being the intercept and <span class="math inline">\(\beta\)</span> the parameter coefficients for
environmental covariates. The log-likelihood can be understood as
cloglog functon.</p>
<p>The Joint likelihood is then estimated by multiplying the two
likelihoods from above <span class="math inline">\(\prod_{l}^{L}
f(l)\)</span>, where <span class="math inline">\(L\)</span> is an
individual likelihood, with <span class="math inline">\(\beta_{k}\)</span> being shared parameters between
the two likelihoods. This works if we assume that <span class="math inline">\(cloglog(p_i) \approx log(\lambda(i))\)</span>.
Equally it is also possible to add shared latent spatial effects such as
Gaussian fields (approximated through a stochastic partial differential
equation (SPDE)) to the model, assuming that there are shared factors -
or biases - affecting all datasets.</p>
<p>See the <a href="04_engine_comparison.html">Engine comparison</a> for
an overview on which engines support which level of integration.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Define a model</span></span>
<span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>      <span class="fu"><a href="../reference/add_predictors.html">add_predictors</a></span><span class="op">(</span>env <span class="op">=</span> <span class="va">predictors</span>, transform <span class="op">=</span> <span class="st">"scale"</span>, derivates <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="co"># A presence only dataset</span></span>
<span>      <span class="fu"><a href="../reference/add_biodiversity_poipo.html">add_biodiversity_poipo</a></span><span class="op">(</span><span class="va">virtual_species</span>,field_occurrence <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>    <span class="co"># A Presence absence dataset</span></span>
<span>      <span class="fu"><a href="../reference/add_biodiversity_poipa.html">add_biodiversity_poipa</a></span><span class="op">(</span><span class="va">virtual_pseudoabs</span>,field_occurrence <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>    <span class="co"># Use inlabru for estimation and default parameters.</span></span>
<span>    <span class="co"># INLA requires the specification of a mesh which in this example is generated from the data.</span></span>
<span>      <span class="fu"><a href="../reference/engine_inlabru.html">engine_inlabru</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Train</span></span>
<span>  <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span>runname <span class="op">=</span> <span class="st">"Combined prediction"</span>, only_linear <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        method_integration <span class="op">=</span> <span class="st">"predictor"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The resulting object contains the combined prediction with shared coefficients among datasets.</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span></code></pre></div>
<p><img src="02_integrate_data_files/figure-html/unnamed-chunk-2-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Note how an overall intercept as well as separate intercepts for each dataset are added.</span></span>
<span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 8</span></span></span>
<span><span class="co">#&gt;    variable                 mean      sd      q05      q50    q95     mode   kld</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Intercept            -<span style="color: #BB0000;">0.327</span>   25.8    -<span style="color: #BB0000;">4.28</span><span style="color: #949494;">e</span>+1 -<span style="color: #BB0000;">0.327</span>   42.1   -<span style="color: #BB0000;">0.327</span>       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Intercept_species.p… -<span style="color: #BB0000;">0.327</span>   25.8    -<span style="color: #BB0000;">4.28</span><span style="color: #949494;">e</span>+1 -<span style="color: #BB0000;">0.327</span>   42.1   -<span style="color: #BB0000;">0.327</span>       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Intercept_species.p… -<span style="color: #BB0000;">0.327</span>   25.8    -<span style="color: #BB0000;">4.28</span><span style="color: #949494;">e</span>+1 -<span style="color: #BB0000;">0.327</span>   42.1   -<span style="color: #BB0000;">0.327</span>       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> bio01_mean_50km      -<span style="color: #BB0000;">0.092</span><span style="color: #BB0000; text-decoration: underline;">9</span>   0.133  -<span style="color: #BB0000;">3.11</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> -<span style="color: #BB0000;">0.092</span><span style="color: #BB0000; text-decoration: underline;">9</span>   0.126 -<span style="color: #BB0000;">0.092</span><span style="color: #BB0000; text-decoration: underline;">9</span>      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> bio03_mean_50km      -<span style="color: #BB0000;">0.438</span>    0.120  -<span style="color: #BB0000;">6.36</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> -<span style="color: #BB0000;">0.438</span>   -<span style="color: #BB0000;">0.240</span> -<span style="color: #BB0000;">0.438</span>       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> bio19_mean_50km       0.456    0.086<span style="text-decoration: underline;">8</span>  3.13<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span>  0.456    0.598  0.456       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> CLC3_112_mean_50km    0.390    0.049<span style="text-decoration: underline;">0</span>  3.09<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span>  0.390    0.470  0.390       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> CLC3_132_mean_50km    0.080<span style="text-decoration: underline;">1</span>   0.049<span style="text-decoration: underline;">5</span> -<span style="color: #BB0000;">1.38</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>  0.080<span style="text-decoration: underline;">1</span>   0.162  0.080<span style="text-decoration: underline;">1</span>      0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> CLC3_211_mean_50km    0.883    0.078<span style="text-decoration: underline;">1</span>  7.54<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span>  0.883    1.01   0.883       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> CLC3_312_mean_50km    1.00     0.066<span style="text-decoration: underline;">0</span>  8.92<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span>  1.00     1.11   1.00        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> elevation_mean_50km   0.009<span style="text-decoration: underline;">33</span>  0.085<span style="text-decoration: underline;">8</span> -<span style="color: #BB0000;">1.32</span><span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span>  0.009<span style="text-decoration: underline;">33</span>  0.150  0.009<span style="text-decoration: underline;">33</span>     0</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Martin Jung.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
