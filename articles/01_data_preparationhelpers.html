<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ibis.iSDM">
<title>Preparation of biodiversity and predictor data • ibis.iSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Preparation of biodiversity and predictor data">
<meta property="og:description" content="ibis.iSDM">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@Martin_Ecology">
<meta name="twitter:site" content="@IIASAVienna">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ibis.iSDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/01_data_preparationhelpers.html">1. Helper functions to prepare inputs</a>
    <a class="dropdown-item" href="../articles/02_train_simple_model.html">2. Train a model</a>
    <a class="dropdown-item" href="../articles/03_integrate_data.html">3. Integrate data</a>
    <a class="dropdown-item" href="../articles/04_biodiversity_projections.html">4. Biodiversity projections</a>
    <a class="dropdown-item" href="../articles/05_mechanistic_estimation.html">5. Simulating mechanisms</a>
    <a class="dropdown-item" href="../articles/06_engine_comparison.html">6. Engine comparison</a>
    <a class="dropdown-item" href="../articles/07_package_comparison.html">7. Other packages</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/08_frequently-asked-questions.html">FAQ</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/contributing.html">Contributing</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/iiasa/ibis.iSDM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Preparation of biodiversity and predictor data</h1>
                        <h4 data-toc-skip class="author">Martin
Jung</h4>
            
            <h4 data-toc-skip class="date">2023-09-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/iiasa/ibis.iSDM/blob/HEAD/vignettes/articles/01_data_preparationhelpers.Rmd" class="external-link"><code>vignettes/articles/01_data_preparationhelpers.Rmd</code></a></small>
      <div class="d-none name"><code>01_data_preparationhelpers.Rmd</code></div>
    </div>

    
    
<p>The first step with any species distribution modelling (SDM) is to
collect and prepare the necessary input data and parameters for the
modelling. Predictors or (environomental) covariates need to be
acquired, in many cases formatted, for example through masking and
reprojections, and standardized. Similarly, Biodiversity data are
usually collected through independent field survey or from available
databases such as GBIF. In particular for the <code>ibis.iSDM</code>
package it can furthermore be useful to collect any other information
available for a biodiversity feature (e.g. species, habitat, …) in
question. Such as for example broad delineation of an expert range or
parameters related to the habitat preference of a species.</p>
<p>Preparing input data for the <code>ibis.iSDM</code> package requires
a modest understanding of modern geospatial R-packages, such as
<code>sf</code>, <code>terra</code> and <code>stars</code>. If such
knowledge is not existing, it is advised to consult a search engine.
Particularly highlighted is the free <a href="https://r.geocompx.org/" class="external-link">Geocomputation with R</a> book. Many
unexpected errors or patterns when using the package can usually be
tracked down to data preparation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://iiasa.github.io/ibis.iSDM/">ibis.iSDM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Don't print out as many messages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"ibis.setupmessages"</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<hr>
<div class="section level2">
<h2 id="preparing-and-altering-biodiversity-data">Preparing and altering biodiversity data<a class="anchor" aria-label="anchor" href="#preparing-and-altering-biodiversity-data"></a>
</h2>
<p>SDM approaches require observation biodiversity data, typically in
the form of presence-only or presence-absence data, which can be
available in a range of different formats from points to polygons.</p>
<p>There are a range of <a href="https://linkinghub.elsevier.com/retrieve/pii/S0304380022003404" class="external-link">existing
tools</a> that assist modellers in preparing and cleaning input data
(for instance of biases). This vignette does intend to give an overview
of the options. Rather it highlights the few functions that have been
created specifically for the <code>ibis.iSDM</code> package and that
might help in some situations.</p>
<div class="section level3">
<h3 id="adding-pseudo-absence-points-to-presence-only-data">Adding pseudo-absence points to presence-only data<a class="anchor" aria-label="anchor" href="#adding-pseudo-absence-points-to-presence-only-data"></a>
</h3>
<p>Although in the philosophy of the <code>ibis.iSDM</code> package it
is advisable to use presence-only models in a Poisson point process
modelling framework (‘poipo’ modelling functions that use background
points (see <a href="http://projecteuclid.org/euclid.aoas/1287409378" class="external-link">Warton and
Sheperd 2010</a>). Yet, a good case can also be made to instead add
pseudo-absence points to existing presence-only data. This allows the
use of logistic regressions and ‘poipa’ methods in
<code>ibis.iSDM</code> which are generally easier to interpret (response
scale from 0 to 1) and also faster to fit as model.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Lets load some testing data from the package</span></span>
<span></span>
<span><span class="co"># Background layer</span></span>
<span><span class="va">background</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/europegrid_50km.tif"</span>,package <span class="op">=</span> <span class="st">"ibis.iSDM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Load virtual species points</span></span>
<span><span class="va">virtual_species</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/input_data.gpkg"</span>,package <span class="op">=</span> <span class="st">"ibis.iSDM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"points"</span>,quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="co"># Add a range </span></span>
<span><span class="va">virtual_range</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/input_data.gpkg'</span>, package<span class="op">=</span><span class="st">'ibis.iSDM'</span><span class="op">)</span>, <span class="st">'range'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Adding pseudo-absence data in the <code>ibis.iSDM package</code>
works by first specifiying a <em>Pseudoabsence options</em> object that
contains parameters how many and where pseudo-absences are to be
sampled. The respective function for this is called
<code><a href="../reference/pseudoabs_settings.html">pseudoabs_settings()</a></code>. Further details on the available
options here (there are many) can be found in the help file. By default
the packages uses a random sampling of absence points and the settings
for this can be queried here
<code>ibis_options()$ibis.pseudoabsence</code>.</p>
<p>After such options have been defined, pseudoa-absence data can be
added to any point dataset via <code><a href="../reference/add_pseudoabsence.html">add_pseudoabsence()</a></code>.</p>
<p>Example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Define new settings for sampling points outside the minimum convex polygon of</span></span>
<span><span class="co"># the known presence data</span></span>
<span><span class="va">abs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pseudoabs_settings.html">pseudoabs_settings</a></span><span class="op">(</span>background <span class="op">=</span> <span class="va">background</span>,</span>
<span>                          nrpoints <span class="op">=</span> <span class="fl">1000</span>, <span class="co"># Sample 1000 points</span></span>
<span>                          method <span class="op">=</span> <span class="st">"mcp"</span>, <span class="co"># Option for minimum convex polygon</span></span>
<span>                          inside <span class="op">=</span>  <span class="cn">FALSE</span> <span class="co"># Sample exclusively outside</span></span>
<span>                            <span class="op">)</span></span>
<span><span class="fu"><a href="../reference/print.html">print</a></span><span class="op">(</span> <span class="va">abs</span> <span class="op">)</span> <span class="co"># See object, check abs$data for the options</span></span>
<span></span>
<span><span class="co"># Now add to the point data</span></span>
<span><span class="va">point1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_pseudoabsence.html">add_pseudoabsence</a></span><span class="op">(</span><span class="va">virtual_species</span>,</span>
<span>                            <span class="co"># Point to the column with the presence information</span></span>
<span>                            field_occurrence <span class="op">=</span> <span class="st">'Observed'</span>,</span>
<span>                            settings <span class="op">=</span> <span class="va">abs</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">point1</span><span class="op">[</span><span class="st">'Observed'</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Define%20and%20add%20pseudo-absence%20data-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># --- #</span></span>
<span><span class="co"># Another option sampling inside the range, but biased by a bias layer</span></span>
<span><span class="va">bias</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/predictors/hmi_mean_50km.tif"</span>,</span>
<span>                                package <span class="op">=</span> <span class="st">"ibis.iSDM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">abs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pseudoabs_settings.html">pseudoabs_settings</a></span><span class="op">(</span>background <span class="op">=</span> <span class="va">background</span>,</span>
<span>                          nrpoints <span class="op">=</span> <span class="fl">100</span>, <span class="co"># Sample 100 points</span></span>
<span>                          method <span class="op">=</span> <span class="st">"range"</span>, <span class="co"># Define range as method</span></span>
<span>                          inside <span class="op">=</span>  <span class="cn">TRUE</span>, <span class="co"># Sample exclusively inside</span></span>
<span>                          layer <span class="op">=</span> <span class="va">virtual_range</span>, <span class="co"># Define the range</span></span>
<span>                          bias <span class="op">=</span> <span class="va">bias</span> <span class="co"># Set a bias layer</span></span>
<span>                            <span class="op">)</span></span>
<span></span>
<span><span class="co"># Add again to the point data</span></span>
<span><span class="va">point2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_pseudoabsence.html">add_pseudoabsence</a></span><span class="op">(</span><span class="va">virtual_species</span>,</span>
<span>                            <span class="co"># Point to the column with the presence information</span></span>
<span>                            field_occurrence <span class="op">=</span> <span class="st">'Observed'</span>,</span>
<span>                            settings <span class="op">=</span> <span class="va">abs</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">point2</span><span class="op">[</span><span class="st">'Observed'</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Define%20and%20add%20pseudo-absence%20data-2.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="thinning-observations">Thinning observations<a class="anchor" aria-label="anchor" href="#thinning-observations"></a>
</h3>
<p>Many presence-only records are often spatially highly biased with
varying observational processes resulting in quite clustered point
observations. For example, urban areas and natural sites near them are
considerably more often frequented by citizens observed wildlife than
sites in remote areas. Particular for Poisson process models that can be
problematic as such models critically assume - without accounting for it
- that the observational process is homogeneous in space.</p>
<p>Thinning observations is a method to remove point observations from
areas that have been “oversampled”. Critically however it does only
remove points from grid cells of a provided background where this is the
case and never removes the entire grid cell fully. It can also be
beneficial for model convergence and modelling speed, as particular for
well-sampled species (e.g. the common blackbird <em>Turdus merula</em>)
there are diminishing returns of fitting a SDM with like 1 million
presence-only points instead of just 20000 well separated ones. The
<code>ibis.iSDM</code> package has its own implementation for spatial
thinning, but one can also refer to <a href="https://doi.org/10.1111/ecog.01132" class="external-link">Aiello-Lammens et al.</a> for
an alternative implementation and rationale for thinning.</p>
<p><strong>Thinning needs to be conducted with care as it effectively
discards data!</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## We use the data loaded in above</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">virtual_species</span><span class="op">[</span><span class="st">'Observed'</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Original data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Thinning-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Random thinning. Note the messages of number of thinned points</span></span>
<span><span class="va">point1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/thin_observations.html">thin_observations</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">virtual_species</span>,</span>
<span>                  background <span class="op">=</span> <span class="va">background</span>,</span>
<span>                  method <span class="op">=</span> <span class="st">'random'</span>,</span>
<span>                  minpoints <span class="op">=</span> <span class="fl">1</span> <span class="co"># Retain at minimum one point per grid cell!</span></span>
<span>                  <span class="op">)</span></span>
<span><span class="co">#&gt; (random) thinning completed! </span></span>
<span><span class="co">#&gt; Original number of records: 208</span></span>
<span><span class="co">#&gt; Number of retained records: 148</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">point1</span><span class="op">[</span><span class="st">'Observed'</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Random thinning"</span><span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Thinning-2.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Another way: Use environmental thinning to retain enough points</span></span>
<span><span class="co"># across the niche defined by a set of covariates</span></span>
<span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/predictors/"</span>, package <span class="op">=</span> <span class="st">"ibis.iSDM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"*.tif"</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">point2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/thin_observations.html">thin_observations</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">virtual_species</span>,</span>
<span>                  background <span class="op">=</span> <span class="va">background</span>,</span>
<span>                  env <span class="op">=</span> <span class="va">covariates</span>,</span>
<span>                  method <span class="op">=</span> <span class="st">'environmental'</span>,</span>
<span>                  minpoints <span class="op">=</span> <span class="fl">5</span> <span class="co"># Retain at minimum five points!</span></span>
<span>                  <span class="op">)</span></span>
<span><span class="co">#&gt; (environmental) thinning completed! </span></span>
<span><span class="co">#&gt; Original number of records: 208</span></span>
<span><span class="co">#&gt; Number of retained records: 46</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">point2</span><span class="op">[</span><span class="st">'Observed'</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Environmentally stratified data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Thinning-3.png" width="700" style="display: block; margin: auto;"></p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="preparing-and-altering-predictor-data">Preparing and altering predictor data<a class="anchor" aria-label="anchor" href="#preparing-and-altering-predictor-data"></a>
</h2>
<p>In order to be used for species distribution modelling all predictors
need to be provided in a common extent, grain size and geographic
projections. They need to align with the provided background extent to
<code><a href="../reference/distribution.html">distribution()</a></code> and should ideally not contain no missing
data. If there are missing data, the package will check and remove
during model fitting points that fall into any grid cells with missing
data.</p>
<p>The <code>ibis.iSDM</code> package has a number of convenience
functions to modify input predictors. These functions rather provide
nuance(s) and variation to the modelling process, rather than preparing
the input data (which needs to be undertaken using the
<code>terra</code> package).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load some test covariates</span></span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/predictors/"</span>, package <span class="op">=</span> <span class="st">"ibis.iSDM"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"*.tif"</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="transforming-predictors">Transforming predictors<a class="anchor" aria-label="anchor" href="#transforming-predictors"></a>
</h3>
<p>For better model convergence it usually makes sense to bring all
predictors to a common unit, for example by noramlizing or scaling them.
The <code>ibis.iSDM</code> package has a convenience function that can
be applied to any <code>terra</code> ‘SpatRaster’ object.</p>
<p><strong>NOTE: This functionality are also available directly in
<code><a href="../reference/add_predictors.html">add_predictors()</a></code> as parameter!</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's take a simple layer for an example</span></span>
<span><span class="va">layer</span> <span class="op">&lt;-</span> <span class="va">predictors</span><span class="op">$</span><span class="va">bio19_mean_50km</span></span>
<span></span>
<span><span class="co"># Transform it in various way</span></span>
<span><span class="va">new1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictor_transform.html">predictor_transform</a></span><span class="op">(</span><span class="va">layer</span>, option <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span><span class="va">new2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictor_transform.html">predictor_transform</a></span><span class="op">(</span><span class="va">layer</span>, option <span class="op">=</span> <span class="st">"scale"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">layer</span>, <span class="va">new1</span>, <span class="va">new2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">new</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"original"</span>, <span class="st">"normalized"</span>, <span class="st">"scaled"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">new</span> <span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Transform%20predictors-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Another common use case is to windsorize a layer, for example by removing</span></span>
<span><span class="co"># top outliers form a prediction.</span></span>
<span><span class="co"># Here the values are capped to a defined percentile</span></span>
<span><span class="va">new3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictor_transform.html">predictor_transform</a></span><span class="op">(</span><span class="va">layer</span>, option <span class="op">=</span> <span class="st">"windsor"</span>,</span>
<span>                            <span class="co"># Clamp the upper values to the 90% percentile</span></span>
<span>                            windsor_props <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">layer</span>, <span class="va">new3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">new</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"original"</span>, <span class="st">"windsorized"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">new</span> <span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Transform%20predictors-2.png" width="700" style="display: block; margin: auto;"></p>
<p>Other options for transformation are also available and are listed in
the methods file.</p>
</div>
<div class="section level3">
<h3 id="derivates-of-predictors">Derivates of predictors<a class="anchor" aria-label="anchor" href="#derivates-of-predictors"></a>
</h3>
<p>A simple linear SDM (e.g. <code><a href="../reference/engine_glmnet.html">engine_glmnet()</a></code>) includes the
predictors as such and thus assumes that any increase in the response
variable follows a linear relationship with the covariate. However,
reality is not always that simple and usually it can be assumed that
many relationships are highly non-linear or otherwise complex.</p>
<p>A standard way to introduce non-linearities to a linear algorithm is
to create derivates of predictors, such as for example a quadratic
transformation of temperature. The <code>ibis.iSDM</code> package has a
convenience function that can be applied to any <code>terra</code>
‘SpatRaster’ object to create such additional derivates for a model.
Note that this creates (in some cases substantial) additional
predictors.</p>
<p><strong>NOTE: This functionality are also available directly in
<code><a href="../reference/add_predictors.html">add_predictors()</a></code> as parameter!</strong></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's take a simple layer for an example</span></span>
<span><span class="va">layer</span> <span class="op">&lt;-</span> <span class="va">predictors</span><span class="op">$</span><span class="va">ndvi_mean_50km</span></span>
<span></span>
<span><span class="co"># Make a quadratic transformation</span></span>
<span><span class="va">new1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictor_derivate.html">predictor_derivate</a></span><span class="op">(</span><span class="va">layer</span>, option <span class="op">=</span> <span class="st">"quadratic"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">layer</span>, <span class="va">new1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">new</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"original"</span>, <span class="st">"quadratic"</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">new</span> <span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Creating%20derivates%20of%20predictors-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Create some hinge transformations</span></span>
<span><span class="va">new2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictor_derivate.html">predictor_derivate</a></span><span class="op">(</span><span class="va">layer</span>, option <span class="op">=</span> <span class="st">"hinge"</span>,</span>
<span>                           <span class="co"># The number is controlled by the number of knots</span></span>
<span>                            nknots <span class="op">=</span> <span class="fl">4</span> </span>
<span>                           <span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">new2</span> <span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Creating%20derivates%20of%20predictors-2.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># What does this do precisely?</span></span>
<span><span class="co"># Lets check</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span> ndvi <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">layer</span><span class="op">)</span>,</span>
<span>                  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">new2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">ndvi_mean_50km</span>, <span class="va">df</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, ylab <span class="op">=</span> <span class="st">"First hinge of ndvi"</span>, xlab <span class="op">=</span> <span class="st">"NDVI"</span><span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Creating%20derivates%20of%20predictors-3.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">ndvi_mean_50km</span>, <span class="va">df</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, ylab <span class="op">=</span> <span class="st">"Second hinge of ndvi"</span>,xlab <span class="op">=</span> <span class="st">"NDVI"</span><span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Creating%20derivates%20of%20predictors-4.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">ndvi_mean_50km</span>, <span class="va">df</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span>, ylab <span class="op">=</span> <span class="st">"Third hinge of ndvi"</span>, xlab <span class="op">=</span> <span class="st">"NDVI"</span><span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Creating%20derivates%20of%20predictors-5.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">ndvi_mean_50km</span>, <span class="va">df</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span>, ylab <span class="op">=</span> <span class="st">"Fourth hinge of ndvi"</span>,xlab <span class="op">=</span> <span class="st">"NDVI"</span><span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Creating%20derivates%20of%20predictors-6.png" width="700" style="display: block; margin: auto;"></p>
<p>More fine-tuned control can also be achieved by creating specific
interactions among variables, for example if one expects climate to
interact with forest cover.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create interacting variables</span></span>
<span></span>
<span><span class="va">new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictor_derivate.html">predictor_derivate</a></span><span class="op">(</span><span class="va">predictors</span>,option <span class="op">=</span> <span class="st">"interaction"</span>,</span>
<span>                          int_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio01_mean_50km"</span>, <span class="st">"CLC3_312_mean_50km"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">new</span>, main <span class="op">=</span> <span class="st">"Interaction variable"</span><span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/Derivate%20interaction-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="homogenize-missing-data-among-predictors">Homogenize missing data among predictors<a class="anchor" aria-label="anchor" href="#homogenize-missing-data-among-predictors"></a>
</h3>
<p>As mentioned above, during model training covariates will be
extracted for each biodiversity observational record. Missing data will
in this case be discarded. For example if 10 predictors are considered
and a single one has a missing value in one grid cell, the grid cell is
considered missing among all other predictors as well. The
<code>ibis.iSDM</code> package has some convenience functions to easily
harmonize and check the extent of missing data in a set of predictors
which can be convenient for assessing errors during data
preparation.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a subset of all predictors to show the concept</span></span>
<span><span class="va">layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">predictors</span>,  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aspect_mean_50km"</span>,</span>
<span>                                        <span class="st">"CLC3_312_mean_50km"</span>,</span>
<span>                                        <span class="st">"elevation_mean_50km"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># All these layers have identical data coverage.</span></span>
<span><span class="co"># Now add missing data in one of the layers for testing</span></span>
<span><span class="va">layers</span><span class="op">$</span><span class="va">CLC3_312_mean_50km</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">layers</span><span class="op">)</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span> </span>
<span></span>
<span><span class="co"># Harmonize the predictors</span></span>
<span><span class="va">new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictor_homogenize_na.html">predictor_homogenize_na</a></span><span class="op">(</span>env <span class="op">=</span> <span class="va">layers</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now all the predictors have identical coverage of NA values</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">new</span><span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/unnamed-chunk-1-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Or assess like this</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="op">!</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">noNA</a></span><span class="op">(</span><span class="va">new</span><span class="op">$</span><span class="va">aspect_mean_50km</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Missing observations"</span><span class="op">)</span></span></code></pre></div>
<p><img src="01_data_preparationhelpers_files/figure-html/unnamed-chunk-1-2.png" width="700" style="display: block; margin: auto;"></p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="preparing-and-altering-future-scenario-data">Preparing and altering future scenario data<a class="anchor" aria-label="anchor" href="#preparing-and-altering-future-scenario-data"></a>
</h2>
<p>&lt; Upcoming :) &gt;</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Martin Jung.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
