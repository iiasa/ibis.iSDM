<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Function to create an ensemble of multiple fitted models — ensemble • ibis.iSDM</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Function to create an ensemble of multiple fitted models — ensemble"><meta name="description" content="Ensemble models calculated on multiple models have often been
shown to outcompete any single model in comparative assessments (Valavi et
al. 2022).
This function creates an ensemble of multiple provided distribution models
fitted with the ibis.iSDM-package. Each model has to have estimated
predictions with a given method and optional uncertainty in form of the
standard deviation or similar. Through the layer parameter it can be
specified which part of the prediction should be averaged in an ensemble.
This can be for instance the mean prediction and/or the standard deviation
sd. See Details below for an overview of the different methods.
Also returns a coefficient of variation (cv) as output of the ensemble, but
note this should not be interpreted as measure of model uncertainty as it
cannot capture parameter uncertainty of individual models; rather it reflects
variation among predictions which can be due to many factors including simply
differences in model complexity."><meta property="og:description" content="Ensemble models calculated on multiple models have often been
shown to outcompete any single model in comparative assessments (Valavi et
al. 2022).
This function creates an ensemble of multiple provided distribution models
fitted with the ibis.iSDM-package. Each model has to have estimated
predictions with a given method and optional uncertainty in form of the
standard deviation or similar. Through the layer parameter it can be
specified which part of the prediction should be averaged in an ensemble.
This can be for instance the mean prediction and/or the standard deviation
sd. See Details below for an overview of the different methods.
Also returns a coefficient of variation (cv) as output of the ensemble, but
note this should not be interpreted as measure of model uncertainty as it
cannot capture parameter uncertainty of individual models; rather it reflects
variation among predictions which can be due to many factors including simply
differences in model complexity."><meta property="og:image" content="https://iiasa.github.io/ibis.iSDM/logo.png"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@Martin_Ecology"><meta name="twitter:site" content="@IIASAVienna"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ibis.iSDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/01_data_preparationhelpers.html">1. Helper functions to prepare inputs</a></li>
    <li><a class="dropdown-item" href="../articles/02_train_simple_model.html">2. Train a model</a></li>
    <li><a class="dropdown-item" href="../articles/03_integrate_data.html">3. Integrate data</a></li>
    <li><a class="dropdown-item" href="../articles/04_biodiversity_projections.html">4. Biodiversity projections</a></li>
    <li><a class="dropdown-item" href="../articles/05_mechanistic_estimation.html">5. Simulating mechanisms</a></li>
    <li><a class="dropdown-item" href="../articles/06_engine_comparison.html">6. Engine comparison</a></li>
    <li><a class="dropdown-item" href="../articles/07_package_comparison.html">7. Other packages</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/08_frequently-asked-questions.html">FAQ</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/contributing.html">Contributing</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/iiasa/ibis.iSDM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Function to create an ensemble of multiple fitted models</h1>
      <small class="dont-index">Source: <a href="https://github.com/iiasa/ibis.iSDM/blob/dev/R/ensemble.R" class="external-link"><code>R/ensemble.R</code></a></small>
      <div class="d-none name"><code>ensemble.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Ensemble models calculated on multiple models have often been
shown to outcompete any single model in comparative assessments (Valavi et
al. 2022).</p>
<p>This function creates an ensemble of multiple provided distribution models
fitted with the <code><a href="ibis.iSDM.html">ibis.iSDM-package</a></code>. Each model has to have estimated
predictions with a given method and optional uncertainty in form of the
standard deviation or similar. Through the <code>layer</code> parameter it can be
specified which part of the prediction should be averaged in an ensemble.
This can be for instance the <em>mean</em> prediction and/or the standard deviation
<em>sd</em>. See Details below for an overview of the different methods.</p>
<p>Also returns a coefficient of variation (cv) as output of the ensemble, but
note this should not be interpreted as measure of model uncertainty as it
cannot capture parameter uncertainty of individual models; rather it reflects
variation among predictions which can be due to many factors including simply
differences in model complexity.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ensemble</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min.value <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  layer <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  normalize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  uncertainty <span class="op">=</span> <span class="st">"cv"</span>,</span>
<span>  point <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  field_occurrence <span class="op">=</span> <span class="st">"observed"</span>,</span>
<span>  apply_threshold <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'ANY'</span></span>
<span><span class="fu">ensemble</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min.value <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  layer <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  normalize <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  uncertainty <span class="op">=</span> <span class="st">"cv"</span>,</span>
<span>  point <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  field_occurrence <span class="op">=</span> <span class="st">"observed"</span>,</span>
<span>  apply_threshold <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Provided <code><a href="DistributionModel-class.html">DistributionModel</a></code> or <code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">SpatRaster</a></code> objects.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Approach on how the ensemble is to be created. See details for
available options (Default: <code>'mean'</code>).</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>(<em>Optional</em>) weights provided to the ensemble function if
weighted means are to be constructed (Default: <code>NULL</code>).</p></dd>


<dt id="arg-min-value">min.value<a class="anchor" aria-label="anchor" href="#arg-min-value"></a></dt>
<dd><p>A optional <code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></code> stating a minimum value that needs
to be surpassed in each layer before calculating and ensemble (Default: <code>NULL</code>).</p></dd>


<dt id="arg-layer">layer<a class="anchor" aria-label="anchor" href="#arg-layer"></a></dt>
<dd><p>A <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></code> of the layer to be taken from each prediction
(Default: <code>'mean'</code>). If set to <code>NULL</code> ignore any of the layer
names in ensembles of <code>SpatRaster</code> objects.</p></dd>


<dt id="arg-normalize">normalize<a class="anchor" aria-label="anchor" href="#arg-normalize"></a></dt>
<dd><p><code><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></code> on whether the inputs of the ensemble should be
normalized to a scale of 0-1 (Default: <code>FALSE</code>).</p></dd>


<dt id="arg-uncertainty">uncertainty<a class="anchor" aria-label="anchor" href="#arg-uncertainty"></a></dt>
<dd><p>A <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></code> indicating how the uncertainty among
models should be calculated. Available options include <code>"none"</code>, the
standard deviation (<code>"sd"</code>), the average of all PCA axes except the
first <code>"pca"</code>, the coefficient of variation (<code>"cv"</code>, Default) or
the range between the lowest and highest value (<code>"range"</code>).</p></dd>


<dt id="arg-point">point<a class="anchor" aria-label="anchor" href="#arg-point"></a></dt>
<dd><p>A <code>sf</code> object containing observational data used for model training. Used
for method <code>'superlearner'</code> only (Default: <code>NULL</code>).</p></dd>


<dt id="arg-field-occurrence">field_occurrence<a class="anchor" aria-label="anchor" href="#arg-field-occurrence"></a></dt>
<dd><p>A <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></code> location of biodiversity point records (Default: <code>'observed'</code>).</p></dd>


<dt id="arg-apply-threshold">apply_threshold<a class="anchor" aria-label="anchor" href="#arg-apply-threshold"></a></dt>
<dd><p>A <code><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></code> flag (Default: <code>TRUE</code>) specifying
whether threshold values should also be created via <code>"method"</code>. Only
applies and works for <code><a href="DistributionModel-class.html">DistributionModel</a></code> and thresholds found.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">SpatRaster</a></code> object containing the ensemble of the provided
predictions specified by <code>method</code> and a coefficient of variation
across all models.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Possible options for creating an ensemble includes:</p><ul><li><p><code>'mean'</code> - Calculates the mean of several predictions.</p></li>
<li><p><code>'median'</code> - Calculates the median of several predictions.</p></li>
<li><p><code>'max'</code> - The maximum value across predictions.</p></li>
<li><p><code>'min'</code> - The minimum value across predictions.</p></li>
<li><p><code>'mode'</code> - The mode/modal values as the most commonly occurring value.</p></li>
<li><p><code>'weighted.mean'</code> - Calculates a weighted mean. Weights have to be supplied separately (e.g. TSS).</p></li>
<li><p><code>'min.sd'</code> - Ensemble created by minimizing the uncertainty among predictions.</p></li>
<li><p><code>'threshold.frequency'</code> - Returns an ensemble based on threshold frequency (simple count). Requires thresholds to be computed.</p></li>
<li><p><code>'pca'</code> - Calculates a PCA between predictions of each algorithm and then extract the first axis (the one explaining the most variation).</p></li>
<li><p><code>'superlearner'</code> - Composites two predictions through a 'meta-model' fitted on top
(using a <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></code> by default). Requires binomial data in current Setup.</p></li>
</ul><p>In addition to the different ensemble methods, a minimal threshold
(<code>min.value</code>) can be set that needs to be surpassed for averaging. By
default this option is not used (Default: <code>NULL</code>).</p>
<p>Note by default only the band in the <code>layer</code> parameter is composited. If
supported by the model other summary statistics from the posterior (e.g.
<code>'sd'</code>) can be specified.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>If a list is supplied, then it is assumed that each entry in the list
is a fitted <code><a href="DistributionModel-class.html">DistributionModel</a></code> object. Take care not to create an ensemble
of models constructed with different link functions, e.g. logistic vs <a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">log</a>.
In this case the <code>"normalize"</code> parameter has to be set.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Valavi, R., Guillera‐Arroita, G., Lahoz‐Monfort, J. J., &amp; Elith, J. (2022).
Predictive performance of presence‐only species distribution models: a benchmark
study with reproducible code. Ecological Monographs, 92(1), e01486.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Method works for fitted models as well as as rasters</span></span></span>
<span class="r-in"><span><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>nrows <span class="op">=</span> <span class="fl">10</span>, ncols <span class="op">=</span> <span class="fl">10</span>, res <span class="op">=</span> <span class="fl">0.05</span>, xmin <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>,</span></span>
<span class="r-in"><span> xmax <span class="op">=</span> <span class="fl">1.5</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, ymax <span class="op">=</span> <span class="fl">1.5</span>, vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">3600</span>,mean <span class="op">=</span> <span class="fl">.5</span>,sd <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>nrows <span class="op">=</span> <span class="fl">10</span>, ncols <span class="op">=</span> <span class="fl">10</span>, res <span class="op">=</span> <span class="fl">0.05</span>, xmin <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>,</span></span>
<span class="r-in"><span> xmax <span class="op">=</span> <span class="fl">1.5</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, ymax <span class="op">=</span> <span class="fl">1.5</span>, vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">3600</span>,mean <span class="op">=</span> <span class="fl">.5</span>,sd <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"mean"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Assumes previously computed predictions</span></span></span>
<span class="r-in"><span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu">ensemble</span><span class="op">(</span><span class="va">r1</span>, <span class="va">r2</span>, method <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ex</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ensemble-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Jung.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

